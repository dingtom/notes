<!doctype html><html lang=zh-cn data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.107.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="面试-mysql"><meta itemprop=description content="Love and Peace"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=keywords content="Hugo,NexT,主题,简单,强大"><meta property="og:type" content="article"><meta property="og:title" content="面试-mysql"><meta property="og:description" content="Love and Peace"><meta property="og:image" content="/imgs/hugo_next_avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/post/%E9%9D%A2%E8%AF%95-mysql/"><meta property="og:site_name" content="Tomding's Blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Tomding"><meta property="article:published_time" content="2022-12-01 19:59:47 +0800 CST"><meta property="article:modified_time" content="2022-12-01 19:59:47 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.0ca97083b39f4eda7430d39b99194aa738d8f8db4090f00bc7e814013df699cb.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"%E9%9D%A2%E8%AF%95-mysql","permalink":"/post/%E9%9D%A2%E8%AF%95-mysql/","title":"面试-mysql","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>面试-mysql - Tomding's Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Tomding's Blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Just do it!</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>73</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#win>win</a></li><li><a href=#centos>centos</a></li><li><a href=#ubuntu>ubuntu</a></li></ul><ul><li><a href=#数据类型的指定>数据类型的指定</a></li><li><a href=#约束的设置>约束的设置</a></li><li><a href=#执行顺序>执行顺序</a></li><li><a href=#ddl>DDL</a></li><li><a href=#dml>DML</a></li><li><a href=#dcl>DCL</a></li></ul><ul><li><a href=#增加create>增加(CREATE)</a></li><li><a href=#删除drop>删除(DROP)</a></li><li><a href=#修改alter>修改(ALTER)</a></li><li><a href=#查询show>查询(SHOW)</a></li><li><a href=#选择数据库>选择数据库</a></li></ul><ul><li><a href=#新建表create>新建表(CREATE)</a></li><li><a href=#删除drop-1>删除(DROP)</a></li><li><a href=#修改表名称alter--rename>修改表名称(ALTER RENAME)</a></li></ul><ul><li><a href=#添加字段alter-add-column>添加字段(ALTER ADD COLUMN)</a></li><li><a href=#删除字段alter-drop-column>删除字段(ALTER DROP COLUMN)</a></li><li><a href=#修改字段类型alter-modify>修改字段类型(ALTER MODIFY)</a></li><li><a href=#修改字段名称alter-change>修改字段名称(ALTER CHANGE)</a></li><li><a href=#显示表字段信息>显示表字段信息</a></li></ul><ul><li><a href=#添加主键alter-add-primary-key>添加主键(ALTER ADD PRIMARY KEY)</a></li><li><a href=#添加数据insert-into>添加数据(INSERT INTO)</a></li><li><a href=#删除delete-from>删除(DELETE FROM)</a><ul><li><a href=#delete-from>DELETE FROM</a></li><li><a href=#truncate>truncate</a></li></ul></li><li><a href=#修改update-set>修改(UPDATE SET)</a></li><li><a href=#查询>查询</a></li></ul><ul><li><a href=#逻辑>逻辑</a></li><li><a href=#比较>比较</a></li><li><a href=#模糊>模糊</a></li><li><a href=#谓词>谓词</a></li><li><a href=#判断>判断</a></li><li><a href=#聚合函数>聚合函数：</a></li><li><a href=#分组查询group-by>分组查询：group by</a></li><li><a href=#分组后筛选-having>分组后筛选： having</a></li><li><a href=#distinct-唯一>DISTINCT 唯一</a></li><li><a href=#分页查询limit-offset>分页查询：limit offset</a></li><li><a href=#排序-order-by>排序： order by</a></li></ul><ul><li><a href=#修改视图>修改视图</a></li><li><a href=#删除视图>删除视图</a></li><li><a href=#子查询和视图的关系>子查询和视图的关系</a></li></ul><ul><li><a href=#笛卡尔积查询>笛卡尔积查询</a></li><li><a href=#内连接查询>内连接查询</a></li><li><a href=#左连接查询>左连接查询</a></li><li><a href=#右连接>右连接</a></li><li><a href=#全连接查询>全连接查询</a></li><li><a href=#子查询>子查询</a></li><li><a href=#自关联查询>自关联查询</a></li></ul><ul><li><a href=#join-vs-union>JOIN vs UNION</a></li></ul><ul><li><a href=#删除用户>删除用户</a></li></ul><ul><li><ul><li><a href=#多表设计>多表设计</a></li></ul></li></ul><ul><li><a href=#执行顺序-1>执行顺序</a></li><li><a href=#滑动窗口函数>滑动窗口函数</a><ul><li><a href=#preceding>Preceding</a></li><li><a href=#following>Following</a></li><li><a href=#preceding跟following相结合>preceding跟following相结合</a></li></ul></li><li><a href=#rollup---计算合计及小计>ROLLUP - 计算合计及小计</a></li></ul><ul><li><a href=#命令行方式>命令行方式</a></li></ul><ul><li><a href=#存储过程语法>存储过程语法</a><ul><li><a href=#变量>变量</a></li><li><a href=#if>if</a></li><li><a href=#输入参数>输入参数</a></li><li><a href=#case>case</a></li><li><a href=#while>while</a></li><li><a href=#repeat>repeat</a></li><li><a href=#loop>loop</a></li><li><a href=#游标>游标</a></li></ul></li><li><a href=#存储函数>存储函数</a></li></ul><ul><li><a href=#触发器演示>触发器演示</a></li></ul><ul><li><a href=#事务的四大特征acid>事务的四大特征(ACID)</a></li><li><a href=#事务的隔离级别>事务的隔离级别</a><ul><li><a href=#隔离级别的概念>隔离级别的概念</a></li><li><a href=#事务隔离级别演示>事务隔离级别演示</a></li><li><a href=#隔离级别总结>隔离级别总结</a></li></ul></li></ul><ul><li><a href=#索引的分类>索引的分类</a></li><li><a href=#索引的实现原理>索引的实现原理</a><ul><li><a href=#磁盘存储>磁盘存储</a></li><li><a href=#btree>BTree</a></li><li><a href=#btree-1>B+Tree</a></li></ul></li><li><a href=#索引的设计原则>索引的设计原则</a></li></ul><ul><li><a href=#锁的概念>锁的概念</a></li><li><a href=#锁的分类>锁的分类</a></li><li><a href=#演示innodb锁>演示InnoDB锁</a></li><li><a href=#演示myisam锁>演示MyISAM锁</a></li><li><a href=#演示悲观锁和乐观锁>演示悲观锁和乐观锁</a></li><li><a href=#锁的总结>锁的总结</a></li></ul><ul><li><ul><li><a href=#mysql体系结构>MySQL体系结构</a></li><li><a href=#mysql存储引擎>MySQL存储引擎</a></li><li><a href=#常用引擎的特性对比>常用引擎的特性对比</a><ul><li><a href=#总结引擎的选择>总结：引擎的选择</a></li></ul></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Tomding src=/imgs/img-lazy-loading.gif data-src=/imgs/hugo_next_avatar.png><p class=site-author-name itemprop=name>Tomding</p><div class=site-description itemprop=description>Love and Peace</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>73</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>5</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/ title="Github → https://github.com/" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=https://www.zhihu.com/hot title="知乎 → https://www.zhihu.com/hot" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2022-12-01T19:59:47+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=279850></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=597></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2022-12-02T02:58:52+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/post/%E9%9D%A2%E8%AF%95-mysql/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=name content="Tomding"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Tomding"><meta itemprop=description content="Love and Peace"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="面试-mysql"><meta itemprop=description content="[TOC] 安装 win https://dev.mysql.com/downloads/mysql/ http://mirrors.sohu.com/mysql/MySQL-8.0/ 配置环境变量path 新建一个my.ini 用记事本打开 [mysqld] # 设置mysql的安装目录 basedir=D:\\software\\java\\mysql-5.7.28-winx64 # 切记此处一定要用双斜杠\\，单斜杠这里会出错"></span><header class=post-header><h1 class=post-title itemprop="name headline">面试-mysql
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/%e9%9d%a2%e8%af%95-mysql.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-12-01 19:59:47 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-12-01 19:59:47 +0800 CST">2022-12-01</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E9%9D%A2%E8%AF%95 itemprop=url rel=index><span itemprop=name>面试</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>28445</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>57分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/post/%E9%9D%A2%E8%AF%95-mysql/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>[TOC]</p><h1 id=安装>安装</h1><h2 id=win>win</h2><blockquote><p><a href=https://dev.mysql.com/downloads/mysql/ title=https://dev.mysql.com/downloads/mysql/ rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://dev.mysql.com/downloads/mysql/
<i class="fa fa-external-link-alt"></i></a>
<a href=http://mirrors.sohu.com/mysql/MySQL-8.0/ title=http://mirrors.sohu.com/mysql/MySQL-8.0/ rel="noopener external nofollow noreferrer" target=_blank class=exturl>http://mirrors.sohu.com/mysql/MySQL-8.0/
<i class="fa fa-external-link-alt"></i></a>
配置环境变量path
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-6c5c4e1ade3e95ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-b6f751a6e0727c08.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
新建一个my.ini 用记事本打开</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span>[<span style=color:#a6e22e>mysqld</span>]
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>设置mysql的安装目录</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>basedir</span><span style=color:#f92672>=</span><span style=color:#a6e22e>D</span><span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>software</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>java</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#ae81ff>5.7</span>.<span style=color:#ae81ff>28</span><span style=color:#f92672>-</span><span style=color:#a6e22e>winx64</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>切记此处一定要用双斜杠</span><span style=color:#960050;background-color:#1e0010>\\，</span><span style=color:#a6e22e>单斜杠这里会出错</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>设置mysql数据库的数据的存放目录</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>datadir</span><span style=color:#f92672>=</span><span style=color:#a6e22e>D</span><span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>software</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>java</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#ae81ff>5.7</span>.<span style=color:#ae81ff>28</span><span style=color:#f92672>-</span><span style=color:#a6e22e>winx64</span><span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#a6e22e>Data</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>此处同上</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>允许最大连接数</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_connections</span><span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>允许连接失败的次数</span><span style=color:#960050;background-color:#1e0010>。</span><span style=color:#a6e22e>这是为了防止有人从该主机试图攻击数据库系统</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_connect_errors</span><span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>服务端使用的字符集默认为UTF8</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>character</span><span style=color:#f92672>-</span><span style=color:#a6e22e>set</span><span style=color:#f92672>-</span><span style=color:#a6e22e>server</span><span style=color:#f92672>=</span><span style=color:#a6e22e>utf8</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>创建新表时将使用的默认存储引擎</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span><span style=color:#f92672>-</span><span style=color:#a6e22e>storage</span><span style=color:#f92672>-</span><span style=color:#a6e22e>engine</span><span style=color:#f92672>=</span><span style=color:#a6e22e>INNODB</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>默认使用</span><span style=color:#960050;background-color:#1e0010>“</span><span style=color:#a6e22e>mysql_native_password</span><span style=color:#960050;background-color:#1e0010>”</span><span style=color:#a6e22e>插件认证</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_authentication_plugin</span><span style=color:#f92672>=</span><span style=color:#a6e22e>mysql_native_password</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>mysql</span>]
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>设置mysql客户端默认字符集</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span><span style=color:#f92672>-</span><span style=color:#a6e22e>character</span><span style=color:#f92672>-</span><span style=color:#a6e22e>set</span><span style=color:#f92672>=</span><span style=color:#a6e22e>utf8</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>client</span>]
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>设置mysql客户端连接服务端时默认使用的端口</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>port</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span><span style=color:#f92672>-</span><span style=color:#a6e22e>character</span><span style=color:#f92672>-</span><span style=color:#a6e22e>set</span><span style=color:#f92672>=</span><span style=color:#a6e22e>utf8</span>
</span></span></code></pre></div><p><strong>管理员权限</strong>下运行cmd</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mysqld -install
</span></span><span style=display:flex><span># 执行初始化代码（会在根目录创建data文件夹，并创建root用户）
</span></span><span style=display:flex><span>mysqld --initialize-insecure --user=mysql
</span></span><span style=display:flex><span># 启动mysql服务
</span></span><span style=display:flex><span>net start mysql
</span></span><span style=display:flex><span># 关闭服务
</span></span><span style=display:flex><span>net stop mysql
</span></span></code></pre></div><blockquote><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-3b3965a4ecafa1f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p></blockquote><p>绿色版</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>------------在D:\mysql\创建my.ini 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------zip版本不带默认的数据库文件，需进行数据库初始化，使用CMD管理员打开并
</span></span><span style=display:flex><span>cd d:\mysql\bin
</span></span><span style=display:flex><span>mysqld --defaults-file=d:\mysql\my.ini --initialize --console
</span></span><span style=display:flex><span>！！！会创建默认数据库并设置默认的root密码，localhost：后面为默认的密码。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------初始化完成之后，需要启动mysql服务，输入一下命令:
</span></span><span style=display:flex><span>&#34;d:\mysql\bin\mysqld&#34; --console    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------现在如果关闭了窗口，mysql服务就停止了，不适用与服务器环境，所以需要将mysql作为windows服务进行开机启动。先停止mysql。
</span></span><span style=display:flex><span>&#34;d:\mysql\bin\mysqld&#34; -u root shutdown
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------安装为windows服务，可以在install后面指定服务名，如果涉及一个服务器安装多个服务，可以在后面写mysql5或者mysql8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd d:\mysql\bin
</span></span><span style=display:flex><span>mysqld  --install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------将d:\mysql\bin 目录增加到系统环境变量path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------允许所有计算机远程链接mysql服务器，执行下面命令后可以从其他服务器远程mysql啦，程序也可以链接了。
</span></span><span style=display:flex><span>use mysql
</span></span><span style=display:flex><span>update user set host = &#39;%&#39; where user = &#39;root&#39;;
</span></span><span style=display:flex><span>flush privileges;
</span></span></code></pre></div><h2 id=centos>centos</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>下载命令：
</span></span><span style=display:flex><span>wget https://dev.mysql.com/get/mysql80-community-release-el7-2.noarch.rpm
</span></span><span style=display:flex><span>用 yum 命令安装下载好的 rpm 包.
</span></span><span style=display:flex><span>yum -y install mysql80-community-release-el7-2.noarch.rpm
</span></span><span style=display:flex><span>安装 MySQL 服务器.
</span></span><span style=display:flex><span>yum -y install mysql-community-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>启动 MySQL
</span></span><span style=display:flex><span>systemctl start  mysqld.service
</span></span><span style=display:flex><span>查看 MySQL 运行状态, Active 后面的状态代表启功服务后为 active (running), 停止后为 inactive (dead), 运行状态如图：
</span></span><span style=display:flex><span>systemctl status mysqld.service
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>重新启动 Mysql 和停止 Mysql 的命令如下：
</span></span><span style=display:flex><span>service mysqld restart  #重新启动 Mysql
</span></span><span style=display:flex><span>systemctl stop mysqld.service   #停止 Mysql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>此时 MySQL 已经开始正常运行, 不过要想进入 MySQL 还得先找出此时 root 用户的密码, 通过如下命令可以在日志文件中找出密码： 为了加强安全性, MySQL8.0 为 root 用户随机生成了一个密码, 在 error log 中, 关于 error log 的位置, 如果安装的是 RPM 包, 则默认是/var/log/mysqld.log.  只有启动过一次 mysql 才可以查看临时密码
</span></span><span style=display:flex><span>使用命令:
</span></span><span style=display:flex><span>grep &#39;temporary password&#39; /var/log/mysqld.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>登录 root 用户
</span></span><span style=display:flex><span>mysql -u root -p
</span></span><span style=display:flex><span>修改密码为&#34;123&#34;, 注意结尾要有分号, 表示语句的结束.
</span></span><span style=display:flex><span>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123&#39;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MySQL 完整的初始密码规则可以通过如下命令查看：
</span></span><span style=display:flex><span>SHOW VARIABLES LIKE &#39;validate_password%&#39;
</span></span><span style=display:flex><span>如果想要设置简单的密码必须要修改约束, 修改两个全局参数：
</span></span><span style=display:flex><span>validate_password_policy代表密码策略, 默认是 1：符合长度, 且必须含有数字, 小写或大写字母, 特殊字符. 设置为 0 判断密码的标准就基于密码的长度了. 一定要先修改两个参数再修改密码
</span></span><span style=display:flex><span>set global validate_password.policy=0;
</span></span><span style=display:flex><span>validate_password_length代表密码长度, 最小值为 4
</span></span><span style=display:flex><span>set global validate_password.length=4; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>但此时还有一个问题, 就是因为安装了 Yum Repository, 以后每次 yum 操作都会自动更新, 如不需要更新, 可以把这个 yum 卸载掉：
</span></span><span style=display:flex><span>[root@localhost ~]# yum -y remove mysql80-community-release-el7-2.noarch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>设置表名为大小写不敏感:
</span></span><span style=display:flex><span>1.用root帐号登录, 使用命令
</span></span><span style=display:flex><span>systemctl stop mysqld.service
</span></span><span style=display:flex><span>停止MySQL数据库服务，修改vi /etc/my.cnf，在[mysqld]下面添加
</span></span><span style=display:flex><span> lower_case_table_names=1
</span></span><span style=display:flex><span>这里的参数 0 表示区分大小写，1 表示不区分大小写. 2.做好数据备份，然后使用下述命令删除数据库数据(删除后, 数据库将恢复到刚安装的状态)
</span></span><span style=display:flex><span>rm -rf /var/lib/mysql
</span></span><span style=display:flex><span>3.重启数据库 ,此时数据库恢复到初始状态.
</span></span><span style=display:flex><span>service mysql start
</span></span><span style=display:flex><span>4.重复安装时的操作, 查找临时密码
</span></span><span style=display:flex><span>grep &#39;temporary password&#39; /var/log/mysqld.log
</span></span><span style=display:flex><span>5.修改密码. 密码8位以上, 大小写符号数据. 如想要使用简单密码, 需按照上述安装流程中的步骤进行操作.
</span></span><span style=display:flex><span>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;****&#39;;update user set host = &#34;%&#34; where user=&#39;root&#39;;
</span></span><span style=display:flex><span>6.刷新MySQL的系统权限相关表
</span></span><span style=display:flex><span>FLUSH PRIVILEGES;
</span></span><span style=display:flex><span>此时, MySQL的表名的大小写不再敏感.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>设置表名为大小写不敏感:
</span></span><span style=display:flex><span>1.用root帐号登录后, 使用命令
</span></span><span style=display:flex><span>systemctl stop mysqld.service
</span></span><span style=display:flex><span>停止MySQL数据库服务，修改vi /etc/my.cnf，在[mysqld]下面添加
</span></span><span style=display:flex><span> lower_case_table_names=1
</span></span><span style=display:flex><span>这里的参数 0 表示区分大小写，1 表示不区分大小写. 2.做好数据备份，然后使用下述命令删除数据库数据(删除后, 数据库将恢复到刚安装的状态)
</span></span><span style=display:flex><span>rm -rf /var/lib/mysql
</span></span><span style=display:flex><span>3.重启数据库 ,此时数据库恢复到初始状态.
</span></span><span style=display:flex><span>service mysql start
</span></span><span style=display:flex><span>4.重复安装时的操作, 查找临时密码
</span></span><span style=display:flex><span>grep &#39;temporary password&#39; /var/log/mysqld.log
</span></span><span style=display:flex><span>5.修改密码. 密码8位以上, 大小写符号数据. 如想要使用简单密码, 需按照上述安装流程中的步骤进行操作.
</span></span><span style=display:flex><span>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;****&#39;;update user set host = &#34;%&#34; where user=&#39;root&#39;;
</span></span><span style=display:flex><span>6.刷新MySQL的系统权限相关表
</span></span><span style=display:flex><span>FLUSH PRIVILEGES;
</span></span><span style=display:flex><span>此时, MySQL的表名的大小写不再敏感.
</span></span></code></pre></div><h2 id=ubuntu>ubuntu</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo apt-get install mysql-server
</span></span><span style=display:flex><span>#sudo apt-get install mysql-client
</span></span></code></pre></div><p><strong>配置远程连接</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>1.将bind-address = 127.0.0.1注释掉
</span></span><span style=display:flex><span>sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
</span></span><span style=display:flex><span>2.登录进数据库：
</span></span><span style=display:flex><span>mysql -uroot -p123456
</span></span><span style=display:flex><span>3.然后，切换到数据库mysql。SQL如下：
</span></span><span style=display:flex><span>use mysql;
</span></span><span style=display:flex><span>4.删除匿名用户。SQL如下：
</span></span><span style=display:flex><span>delete from user where user=&#39;&#39;;
</span></span><span style=display:flex><span>5.给root授予在任意主机（%）访问任意数据库的所有权限。SQL语句如下：
</span></span><span style=display:flex><span>create user &#39;root&#39;@&#39;%&#39; identified by &#39;123456&#39;;
</span></span><span style=display:flex><span>grant all privileges on *.* to &#39;root&#39;@&#39;%&#39;;
</span></span><span style=display:flex><span>ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;; 
</span></span><span style=display:flex><span>6.退出数据库
</span></span><span style=display:flex><span>exit
</span></span><span style=display:flex><span>7.重启数据库：
</span></span><span style=display:flex><span>sudo service mysql restart
</span></span></code></pre></div><p><strong>删除 mysql</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo apt-get autoremove --purge mysql-server
</span></span><span style=display:flex><span>sudo apt-get remove mysql-server
</span></span><span style=display:flex><span>sudo apt-get autoremove mysql-server
</span></span><span style=display:flex><span>sudo apt-get remove mysql-common
</span></span></code></pre></div><p><strong>清理残留数据</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>dpkg -l |grep ^rc|awk &#39;{print $2}&#39; |sudo xargs dpkg -P
</span></span></code></pre></div><p>进入mysql</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo mysql -uroot -p 
</span></span></code></pre></div><p>配置 MySQL 的管理员密码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo mysqladmin -u root password newpassword
</span></span></code></pre></div><p>安装MySQL-workbench</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo apt-get install mysql-workbench
</span></span></code></pre></div><p>一旦安装完成，MySQL 服务器应该自动启动。您可以在终端提示符后运行以下命令来检查 MySQL 服务器是否正在运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo netstat -tap | grep mysql
</span></span></code></pre></div><p>当您运行该命令时，您可以看到类似下面的行：
tcp 0 0 localhost.localdomain:mysql <em>:</em> LISTEN -
如果服务器不能正常运行，您可以通过下列命令启动它：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo /etc/init.d/mysql restart
</span></span></code></pre></div><h1 id=重置密码>重置密码</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>net stop mysql，停止MySQL服务，
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>开启跳过密码验证登录的MySQL服务
</span></span><span style=display:flex><span> mysqld --console --skip-grant-tables --shared-memory 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>再打开一个新的cmd，无密码登录MySQL
</span></span><span style=display:flex><span>mysql -u root -p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>密码置为空
</span></span><span style=display:flex><span>    use mysql
</span></span><span style=display:flex><span>    update user set authentication_string=&#39;&#39; where user=&#39;root&#39;;
</span></span><span style=display:flex><span>出mysql，执行命令：
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    quit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>关闭以-console --skip-grant-tables --shared-memory 启动的MySQL服务，
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>打开命令框，输入：net start mysql  启动MySQL服务，一管理员的身份运行cmd。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>步骤4密码已经置空，所以无密码状态登录MySQL，输入登录命令：mysql -u root -p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>利用上一篇博客中更改密码的命令，成功修改密码
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123&#39;;
</span></span></code></pre></div><h1 id=dbms的种类>DBMS的种类</h1><p>用来管理数据库的计算机系统称为数据库管理系统（Database Management System，DBMS）。</p><p>DBMS 主要通过数据的保存格式（数据库的种类）来进行分类，现阶段主要有以下 5 种类型.</p><ul><li><p>层次数据库（Hierarchical Database，HDB）</p></li><li><p>关系数据库（Relational Database，RDB）</p><ul><li>Oracle Database：甲骨文公司的RDBMS</li><li>SQL Server：微软公司的RDBMS</li><li>DB2：IBM公司的RDBMS</li><li>PostgreSQL：开源的RDBMS</li><li>MySQL：开源的RDBMS</li></ul><p>如上是5种具有代表性的RDBMS，其特点是由行和列组成的二维表来管理数据，这种类型的 DBMS 称为关系数据库管理系统（Relational Database Management System，RDBMS）。</p></li><li><p>面向对象数据库（Object Oriented Database，OODB）</p></li><li><p>XML数据库（XML Database，XMLDB）</p></li><li><p>键值存储系统（Key-Value Store，KVS），举例：MongoDB</p></li></ul><h1 id=基本书写规则>基本书写规则</h1><ul><li>SQL语句要以分号（ ; ）结尾</li><li>SQL 不区分关键字的大小写，但是插入到表中的数据是区分大小写的</li><li>win 系统默认不区分表名及字段名的大小写</li><li>linux / mac 默认严格区分表名及字段名的大小写 * 本教程已统一调整表名及字段名的为小写，以方便初学者学习使用。</li><li>注释是SQL语句中用来标识说明或者注意事项的部分。分为1行注释"&ndash; &ldquo;和多行注释两种&rdquo;/* */"。</li></ul><h2 id=数据类型的指定>数据类型的指定</h2><p>数据库创建的表，所有的列都必须指定数据类型，每一列都不能存储与该列数据类型不符的数据。</p><p>四种最基本的数据类型</p><ul><li>INTEGER 型</li></ul><p>用来指定存储整数的列的数据类型（数字型），不能存储小数。</p><ul><li>CHAR 型</li></ul><p>用来存储定长字符串，当列中存储的字符串长度达不到最大长度的时候，使用半角空格进行补足，由于会浪费存储空间，所以一般不使用。</p><ul><li>VARCHAR 型</li></ul><p>用来存储可变长度字符串，定长字符串在字符数未达到最大长度时会用半角空格补足，但可变长字符串不同，即使字符数未达到最大长度，也不会用半角空格补足。</p><ul><li>DATE 型</li></ul><p>用来指定存储日期（年月日）的列的数据类型（日期型）。</p><h2 id=约束的设置>约束的设置</h2><p>约束是除了数据类型之外，对列中存储的数据进行限制或者追加条件的功能。</p><p><code>NOT NULL</code>是非空约束，即该列必须输入数据。</p><p><code>PRIMARY KEY</code>是主键约束，代表该列是唯一值，可以通过该列取出特定的行的数据。</p><h2 id=执行顺序>执行顺序</h2><p>在加入窗口函数的基础上SQL的执行顺序也会发生变化，具体的执行顺序如下（window就是窗口函数）
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-cd689024f076a36a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><h2 id=ddl>DDL</h2><p>DDL（Data Definition Language，数据定义语言） 用来<strong>创建或者删除存储数据用的数据库以及数据库中的表</strong>等对象。DDL 包含以下几种指令。</p><ul><li>CREATE ： 创建数据库和表等对象</li><li>DROP ： 删除数据库和表等对象</li><li>ALTER ： 修改数据库和表等对象的结构</li></ul><h2 id=dml>DML</h2><p>DML（Data Manipulation Language，数据操纵语言） 用来<strong>查询或者变更</strong>表中的记录。DML 包含以下几种指令。</p><ul><li>SELECT ：查询表中的数据</li><li>INSERT ：向表中插入新数据</li><li>UPDATE ：更新表中的数据</li><li>DELETE ：删除表中的数据</li></ul><h2 id=dcl>DCL</h2><p>DCL（Data Control Language，数据控制语言） 用来<strong>确认或者取消对数据库中的数据进行的变更</strong>。除此之外，还可以对 RDBMS 的用户是否有权限操作数据库中的对象（数据库表等）进行设定。DCL 包含以下几种指令。</p><ul><li>COMMIT ： 确认对数据库中的数据进行的变更</li><li>ROLLBACK ： 取消对数据库中的数据进行的变更</li><li>GRANT ： 赋予用户操作权限</li><li>REVOKE ： 取消用户的操作权限</li></ul><h1 id=增删改查库>增删改查库</h1><h2 id=增加create>增加(CREATE)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>数据库名称</span> <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>character</span> utf8;
</span></span></code></pre></div><h2 id=删除drop>删除(DROP)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#960050;background-color:#1e0010>库名</span> ;
</span></span></code></pre></div><h2 id=修改alter>修改(ALTER)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#960050;background-color:#1e0010>库名</span>  <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>character</span> gbk;
</span></span></code></pre></div><h2 id=查询show>查询(SHOW)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>DATABASE</span> 
</span></span></code></pre></div><h2 id=选择数据库>选择数据库</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>USE</span> <span style=color:#960050;background-color:#1e0010>库名</span> ;
</span></span></code></pre></div><h1 id=增删改查表>增删改查表</h1><h2 id=新建表create>新建表(CREATE)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>( <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>数据类型</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>该列所需约束</span> <span style=color:#f92672>&gt;</span> ,
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010> </span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>数据类型</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>该列所需约束</span> <span style=color:#f92672>&gt;</span> ,
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010> </span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>数据类型</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>该列所需约束</span> <span style=color:#f92672>&gt;</span> ,
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010> </span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>数据类型</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>该列所需约束</span> <span style=color:#f92672>&gt;</span> ,
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010> </span> <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>该表的约束</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;</span> , <span style=color:#f92672>&lt;</span> <span style=color:#960050;background-color:#1e0010>该表的约束</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>&gt;</span> ,<span style=color:#960050;background-color:#1e0010>……</span>);
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010> </span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> (
</span></span><span style=display:flex><span>  id <span style=color:#66d9ef>int</span>(<span style=color:#ae81ff>10</span>) <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> COMMENT <span style=color:#e6db74>&#39;Id&#39;</span>,
</span></span><span style=display:flex><span>  username <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;default&#39;</span> COMMENT <span style=color:#e6db74>&#39;用户名&#39;</span>,
</span></span><span style=display:flex><span>  password <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;default&#39;</span> COMMENT <span style=color:#e6db74>&#39;密码&#39;</span>,
</span></span><span style=display:flex><span>  email <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;default&#39;</span> COMMENT <span style=color:#e6db74>&#39;邮箱&#39;</span>
</span></span><span style=display:flex><span>) COMMENT<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;用户表&#39;</span>;
</span></span></code></pre></div><p><strong>复制表</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>新表</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#960050;background-color:#1e0010>旧表</span> 
</span></span></code></pre></div><h2 id=删除drop-1>删除(DROP)</h2><p>ALTER TABLE 语句和 DROP TABLE 语句一样，执行之后无法恢复。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span>;
</span></span></code></pre></div><h2 id=修改表名称alter--rename>修改表名称(ALTER RENAME)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>RENAME</span> user_new;
</span></span></code></pre></div><h1 id=增删改查字段>增删改查字段</h1><h2 id=添加字段alter-add-column>添加字段(ALTER ADD COLUMN)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>COLUMN</span> age <span style=color:#66d9ef>int</span>(<span style=color:#ae81ff>3</span>);
</span></span></code></pre></div><h2 id=删除字段alter-drop-column>删除字段(ALTER DROP COLUMN)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>COLUMN</span> age;
</span></span></code></pre></div><h2 id=修改字段类型alter-modify>修改字段类型(ALTER MODIFY)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> MODIFY <span style=color:#960050;background-color:#1e0010>字段名</span> <span style=color:#960050;background-color:#1e0010>新的字段类型</span>;
</span></span></code></pre></div><p>mysql 设置字段 not null 变成可以null</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> MODIFY <span style=color:#960050;background-color:#1e0010>字段名</span> <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>
</span></span></code></pre></div><h2 id=修改字段名称alter-change>修改字段名称(ALTER CHANGE)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> CHANGE <span style=color:#960050;background-color:#1e0010>旧字段名</span> <span style=color:#960050;background-color:#1e0010>新字段名</span> <span style=color:#960050;background-color:#1e0010>字段类型</span>;
</span></span></code></pre></div><h2 id=显示表字段信息>显示表字段信息</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>DESC</span> <span style=color:#66d9ef>user</span>;
</span></span></code></pre></div><h1 id=管理数据>管理数据</h1><h2 id=添加主键alter-add-primary-key>添加主键(ALTER ADD PRIMARY KEY)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (id);
</span></span></code></pre></div><p><strong>删除主键</strong>(ALTER DROP PRIMARY KEY)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>;
</span></span></code></pre></div><p>查询表的大小：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>use</span> information_schema;  
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> data_length,index_length 
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> <span style=color:#66d9ef>tables</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> table_schema<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>库</span> <span style=color:#66d9ef>and</span> table_name <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>表</span> ;
</span></span></code></pre></div><h2 id=添加数据insert-into>添加数据(INSERT INTO)</h2><p>插入完整的行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>10</span>, <span style=color:#e6db74>&#39;root&#39;</span>, <span style=color:#e6db74>&#39;root&#39;</span>, <span style=color:#e6db74>&#39;xxxx@163.com&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 多行INSERT （ DB2、SQL、SQL Server、 PostgreSQL 和 MySQL多行插入）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> productins <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;0002&#39;</span>, <span style=color:#e6db74>&#39;打孔器&#39;</span>, <span style=color:#e6db74>&#39;办公用品&#39;</span>, <span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>320</span>, <span style=color:#e6db74>&#39;2009-09-11&#39;</span>),
</span></span><span style=display:flex><span>                              (<span style=color:#e6db74>&#39;0003&#39;</span>, <span style=color:#e6db74>&#39;运动T恤&#39;</span>, <span style=color:#e6db74>&#39;衣服&#39;</span>, <span style=color:#ae81ff>4000</span>, <span style=color:#ae81ff>2800</span>, <span style=color:#66d9ef>NULL</span>),
</span></span><span style=display:flex><span>                              (<span style=color:#e6db74>&#39;0004&#39;</span>, <span style=color:#e6db74>&#39;菜刀&#39;</span>, <span style=color:#e6db74>&#39;厨房用具&#39;</span>, <span style=color:#ae81ff>3000</span>, <span style=color:#ae81ff>2800</span>, <span style=color:#e6db74>&#39;2009-09-20&#39;</span>);  
</span></span><span style=display:flex><span><span style=color:#75715e>-- Oracle中的多行INSERT
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>INTO</span> productins <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;0002&#39;</span>, <span style=color:#e6db74>&#39;打孔器&#39;</span>, <span style=color:#e6db74>&#39;办公用品&#39;</span>, <span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>320</span>, <span style=color:#e6db74>&#39;2009-09-11&#39;</span>)
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>INTO</span> productins <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;0003&#39;</span>, <span style=color:#e6db74>&#39;运动T恤&#39;</span>, <span style=color:#e6db74>&#39;衣服&#39;</span>, <span style=color:#ae81ff>4000</span>, <span style=color:#ae81ff>2800</span>, <span style=color:#66d9ef>NULL</span>)
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>INTO</span> productins <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;0004&#39;</span>, <span style=color:#e6db74>&#39;菜刀&#39;</span>, <span style=color:#e6db74>&#39;厨房用具&#39;</span>, <span style=color:#ae81ff>3000</span>, <span style=color:#ae81ff>2800</span>, <span style=color:#e6db74>&#39;2009-09-20&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>DUAL</span>;  
</span></span><span style=display:flex><span><span style=color:#75715e>-- DUAL是Oracle特有（安装时的必选项）的一种临时表A。因此“SELECT *FROM DUAL” 部分也只是临时性的，并没有实际意义。  
</span></span></span></code></pre></div><p>插入行的一部分</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>user</span>(username, password, email) <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;admin&#39;</span>, <span style=color:#e6db74>&#39;admin&#39;</span>, <span style=color:#e6db74>&#39;xxxx@163.com&#39;</span>);
</span></span></code></pre></div><p><strong>插入查询出来的数据</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>user</span>(<span style=color:#960050;background-color:#1e0010>字段</span>) <span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>字段</span> <span style=color:#66d9ef>FROM</span> account;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>INTO</span> new_<span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>FROM</span> <span style=color:#960050;background-color:#1e0010>表名</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>//</span> MySQL <span style=color:#960050;background-color:#1e0010>数据库不支持</span> <span style=color:#66d9ef>SELECT</span> ... <span style=color:#66d9ef>INTO</span> <span style=color:#960050;background-color:#1e0010>语句，但支持</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> ... <span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> p1  <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> product;
</span></span></code></pre></div><h2 id=删除delete-from>删除(DELETE FROM)</h2><h3 id=delete-from>DELETE FROM</h3><p>1)可以<strong>带条件删除</strong>2）只能删除表的数据，<strong>不能删除表的约束</strong>3)删除的数据<strong>可以回滚（事务）</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> username<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;robot&#39;</span>;
</span></span></code></pre></div><h3 id=truncate>truncate</h3><p>1）不能带条件删除 2）可以删除表的数据，也可以删除表的约束 3）不能回滚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span>TRUNCATE <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span>;
</span></span></code></pre></div><blockquote><p>总结：
1、在速度上，一般来说，drop> truncate > delete。
2、在使用drop和truncate时一定要注意，虽然可以恢复，但为了减少麻烦，还是要慎重。
3、如果想删除部分数据用delete，注意带上where子句，回滚段要足够大；
如果想<strong>删除表</strong>，当然用drop；
如果想<strong>保留表而将所有数据删除</strong>，如果<strong>和事务无关</strong>，用truncate即可；
如果<strong>和事务有关，或者想触发trigger</strong>，还是用delete；
如果是整理表内部的碎片，可以用truncate跟上reuse stroage，再重新导入/插入数据。</p></blockquote><p>希望删除表结构时，用 drop;
希望保留表结构，但要删除所有记录时， 用 truncate;
希望保留表结构，但要删除部分记录时， 用 delete。</p><h2 id=修改update-set>修改(UPDATE SET)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> username<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;robot&#39;</span>, password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;robot&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;root&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 合并后的写法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> product
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>SET</span> sale_price <span style=color:#f92672>=</span> sale_price <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>       purchase_price <span style=color:#f92672>=</span> purchase_price <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> product_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;厨房用具&#39;</span>;<span style=color:#960050;background-color:#1e0010>  </span>
</span></span></code></pre></div><h2 id=查询>查询</h2><p>所有字段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>表</span>;
</span></span></code></pre></div><p>指定字段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#960050;background-color:#1e0010>字段</span> <span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>表</span>;
</span></span></code></pre></div><p>指定别名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#960050;background-color:#1e0010>字段</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>as</span> <span style=color:#960050;background-color:#1e0010>别名</span> <span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>表</span>;
</span></span></code></pre></div><p>合并列：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> (<span style=color:#960050;background-color:#1e0010>字段</span><span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#960050;background-color:#1e0010>字段</span><span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>as</span> <span style=color:#960050;background-color:#1e0010>“和”</span> <span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>表</span>;
</span></span></code></pre></div><p>去重：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>distinct</span> <span style=color:#960050;background-color:#1e0010>字段</span> <span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>表</span>;
</span></span></code></pre></div><h1 id=特殊字符>特殊字符</h1><h2 id=逻辑>逻辑</h2><p><strong>and、 or、in、not in</strong></p><p><code>select * from 表 where 条件1 and/or 条件2</code>
<code>IN ("A", "B", "C")</code> ––使用IN 和 NOT IN 时是无法选取出NULL数据的。</p><h2 id=比较>比较</h2><p><strong>> 、 &lt; 、>= 、 &lt;= 、 =、 !=、 &lt;>、 between and</strong></p><p><code>select * from 表 where 字段>=条件;</code></p><h2 id=模糊>模糊</h2><p><strong>like 、%（替换任意个字符）、 _（替换一个字符）</strong></p><p><code>SELECT * FROM student WHERE NAME LIKE '李%';</code></p><h2 id=谓词>谓词</h2><p>返回值为真值的函数。包括<code>TRUE / FALSE / UNKNOWN</code>。</p><p>谓词主要有以下几个：</p><ul><li><p>LIKE</p></li><li><p>BETWEEN</p></li><li><p>IS NULL、IS NOT NULL</p><p><strong>NULL 只能使用 IS NULL 和 IS NOT NULL 来进行判断。</strong></p></li><li><p>IN</p></li><li><p>EXISTS</p><p>谓词的作用就是 <strong>“判断是否存在满足某种条件的记录”</strong>。如果存在这样的记录就返回真（TRUE），如果不存在就返回假（FALSE）。</p></li></ul><h2 id=判断>判断</h2><p><strong>case when 条件 then 真的操作 else 假的操作 end</strong></p><p><strong>if(条件, 真的操作, 假的操作)</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> product_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;衣服&#39;</span> <span style=color:#66d9ef>THEN</span> <span style=color:#a6e22e>CONCAT</span>(<span style=color:#e6db74>&#39;A ： &#39;</span>,product_type)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHEN</span> product_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;办公用品&#39;</span>  <span style=color:#66d9ef>THEN</span> <span style=color:#a6e22e>CONCAT</span>(<span style=color:#e6db74>&#39;B ： &#39;</span>,product_type)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHEN</span> product_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;厨房用具&#39;</span>  <span style=color:#66d9ef>THEN</span> <span style=color:#a6e22e>CONCAT</span>(<span style=color:#e6db74>&#39;C ： &#39;</span>,product_type)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>ELSE</span> <span style=color:#66d9ef>NULL</span>
</span></span><span style=display:flex><span>END
</span></span></code></pre></div><h2 id=聚合函数>聚合函数：</h2><p>聚合函数的使用前提是结果集已经确定，而WHERE还处于确定结果集的过程中，所以相互矛盾会引发错误。 如果<strong>想指定条件，可以在SELECT，HAVING（下面马上会讲）以及ORDER BY子句中使用聚合函数。</strong></p><p><code>sum()、avg() 、 max() 、min() 、 count()</code></p><p><strong>count()</strong></p><blockquote><p>COUNT(常量) 和 COUNT(*)表示的是直接查询符合条件的数据库表的行数。而COUNT(列名)表示的是查询符合条件的列的值不为NULL的行数。</p></blockquote><p><code>SELECT SUM(servlet) AS 'servlet的总成绩' FROM student;</code>
<code>SELECT COUNT(*) FROM student;</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 计算去除重复数据后的数据行数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>COUNT</span>(<span style=color:#66d9ef>DISTINCT</span> product_type)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>FROM</span> product;
</span></span></code></pre></div><p><code>concat</code>将A和B按顺序连接在一起的字符串
<code>split(str, regex)</code>将string类型数据按regex提取，分隔后转换为array。
<code>substr（str,0,len) </code>截取字符串从0位开始的长度为len个字符。
<code>SUBSTRING_INDEX (原始字符串， 分隔符，n)</code>获取原始字符串按照分隔符分割后，第 n 个分隔符之前（或之后）的子字符串，支持正向和反向索引，索引起始值分别为 1 和 -1。
<code>LOCATE()</code>查找某字符在长字符中的位置
<code>LEFT()、RIGHT()</code>左边或者右边的字符
<code>LOWER()、UPPER()</code>转换为小写或者大写
<code>LTRIM()、RTIM()</code>去除左边或者右边的空格
<code>LENGTH()</code>长度
<code>SOUNDEX()</code>转换为语音值
其中， SOUNDEX() 可以将一个字符串转换为描述其语音表示的字母数字模式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> mytable
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#a6e22e>SOUNDEX</span>(col1) <span style=color:#f92672>=</span> <span style=color:#a6e22e>SOUNDEX</span>(<span style=color:#e6db74>&#39;apple&#39;</span>)
</span></span></code></pre></div><p>常用的日期提取函数包括 <code>year()/month()/day()/hour()/minute()/second()</code></p><p>CURRENT_DATE &ndash; 获取当前日期
CURRENT_TIME &ndash; 当前时间
CURRENT_TIMESTAMP &ndash; 当前日期和时间
EXTRACT(日期元素 FROM 日期)&ndash; 截取日期元素
<code>EXTRACT(YEAR FROM CURRENT_TIMESTAMP) AS year</code></p><p><code>AddDate()</code>增加一个日期（天、周等）
<code>AddTime()</code>增加一个时间（时、分等）
<code>CurDate()</code>返回当前日期
<code>CurTime()</code>返回当前时间
<code>Date()</code>返回日期时间的日期部分
<code>to_date("1970-01-01 00:00:00")</code>把时间的字符串形式转化为时间类型，再进行后续的计算；
<code>datediff(enddate,stratdate) </code>计算两个时间的时间差（day)；
<code>date_sub(stratdate,days) </code>返回开始日期startdate减少days天后的日期。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>ADDDATE</span>(<span style=color:#e6db74>&#34;2017-06-15&#34;</span>, <span style=color:#66d9ef>INTERVAL</span> <span style=color:#ae81ff>10</span> DAY);
</span></span></code></pre></div><p><code>date_add(startdate,days) </code>返回开始日期startdate增加days天后的日期。
<code>Date_Format()</code>返回一个格式化的日期或时间串
<code>date(paidTime).date_format(paidTime，%Y-%m-d%)</code></p><p><code>CAST（转换前的值 AS 想要转换的数据类型）</code> &ndash; 将NULL转换为其他值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>SELECT CAST(&#39;0001&#39; AS SIGNED INTEGER) AS int_col;
</span></span></code></pre></div><p><code>COALESCE(数据1，数据2，数据3……)</code> &ndash; 返回可变参数 A 中左侧开始第 1个不是NULL的值</p><p><code>SIN()</code>正弦
<code>COS()</code>余弦
<code>TAN()</code>正切
<code>ABS()</code>绝对值
<code>SQRT()</code>平方根
<code>MOD()</code>余数
<code>EXP()</code>指数
<code>PI()</code>圆周率
<code>RAND()</code>随机数
<code>percentile()</code> 百分位函数</p><h2 id=分组查询group-by>分组查询：group by</h2><p>使用COUNT等聚合函数时，<strong>SELECT子句中如果出现列名，只能是GROUP BY子句中指定的列名</strong>（也就是聚合键）。</p><p>SELECT子句中可以通过AS来指定别名，但在<strong>GROUP BY中不能使用别名</strong>。因为在DBMS中 ,SELECT子句在GROUP BY子句后执行。</p><p><strong>group by 后可加聚合函数，where 后不能加聚合函数</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 按照商品种类统计数据行数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> product_type, <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> product
</span></span><span style=display:flex><span> <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> product_type;
</span></span><span style=display:flex><span><span style=color:#f92672>-</span><span style=color:#75715e>-- error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> product_name, <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> product
</span></span><span style=display:flex><span> <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> purchase_price;
</span></span></code></pre></div><h2 id=分组后筛选-having>分组后筛选： having</h2><p>WHERE子句只能指定记录（行）的条件，而不能用来指定组的条件（例如，“数据行数为 2 行”或者“平均值为 500”等）。</p><p>可以使用<strong>数字、聚合函数和GROUP BY中指定的列名</strong>（聚合键）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> product_type, <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> product
</span></span><span style=display:flex><span> <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> product_type
</span></span><span style=display:flex><span><span style=color:#66d9ef>HAVING</span> <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 错误形式（因为product_name不包含在GROUP BY聚合键中）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> product_type, <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> product
</span></span><span style=display:flex><span> <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> product_type
</span></span><span style=display:flex><span><span style=color:#66d9ef>HAVING</span> product_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;圆珠笔&#39;</span>;
</span></span></code></pre></div><h2 id=distinct-唯一>DISTINCT 唯一</h2><ul><li>想要计算值的种类时，可以在COUNT函数的参数中使用DISTINCT。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>SELECT DISTINCT Director FROM movies ASC;
</span></span></code></pre></div><h2 id=分页查询limit-offset>分页查询：limit offset</h2><p>起始行,查询行数起始行从0开始
把结果集分页，每页3条记录。要获取第1页的记录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>SELECT * FROM student LIMIT 3 OFFSET 0;
</span></span></code></pre></div><h2 id=排序-order-by>排序： order by</h2><ul><li>ORDER BY中列名可使用别名</li></ul><p>asc: 正序（默认）desc：反序</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> movies 
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> Director <span style=color:#66d9ef>ASC</span>,<span style=color:#66d9ef>Year</span> <span style=color:#66d9ef>DESC</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>10</span> OFFSET <span style=color:#ae81ff>0</span>;
</span></span></code></pre></div><h1 id=视图>视图</h1><p>视图是一个<strong>虚拟的表</strong>，不同于直接操作数据表，视图是依据SELECT语句来创建的，<strong>将频繁使用的SELECT语句保存以提高效率</strong>。</p><ol><li><p>简单</p><p>对于使用视图的用户不需要关心表的结构、关联条件和筛选条件。因为这张虚拟表中保存的就是已经过滤好条件的结果集</p></li><li><p>安全</p><p>视图可以设置权限 , 致使访问视图的用户只能访问他们被允许查询的结果集</p></li><li><p>数据独立</p><p>一旦视图的结构确定了，可以屏蔽表结构变化对用户的影响，源表增加列对视图没有影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> VIEW <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>视图名称</span><span style=color:#f92672>&gt;</span>(<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>列名</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;</span>,...) <span style=color:#66d9ef>AS</span> <span style=color:#f92672>&lt;</span>SELECT<span style=color:#960050;background-color:#1e0010>语句</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建一个视图。将查询出来的结果保存到这张虚拟表中，查询城市和所属国家
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span>
</span></span><span style=display:flex><span>VIEW
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>city_country</span> (city_id,city_name,cid,country_name) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>SELECT</span> t1.<span style=color:#f92672>*</span>,t2.country_name <span style=color:#66d9ef>FROM</span> city t1,country t2 <span style=color:#66d9ef>WHERE</span> t1.cid<span style=color:#f92672>=</span>t2.id;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询视图。查询这张虚拟表，就等效于查询城市和所属国家
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> city_country;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有数据表，视图也会查询出来
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>TABLES</span>;
</span></span></code></pre></div><p>需要注意的是<strong>视图名在数据库中需要是唯一的，不能与其他视图和表重名。在创建视图时也尽量使用限制不允许通过视图来修改表</strong></p><p>视图不仅可以基于真实表，我们也可以在视图的基础上继续创建视图。虽然在视图上继续创建视图的语法没有错误，但是我们还是应该尽量避免这种操作。这是因为对多数 DBMS 来说， <strong>多重视图会降低 SQL 的性能</strong>。</p><p>需要注意的是<strong>在一般的DBMS中定义视图时不能使用ORDER BY语句</strong>。下面这样定义视图是错误的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> VIEW <span style=color:#a6e22e>productsum</span> (product_type, cnt_product)
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> product_type, <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> product
</span></span><span style=display:flex><span> <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> product_type
</span></span><span style=display:flex><span> <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> product_type;
</span></span></code></pre></div><p>为什么不能使用 ORDER BY 子句呢？这是<strong>因为视图和表一样，数据行都是没有顺序的</strong>。</p><p><em>在 MySQL中视图的定义是允许使用 ORDER BY 语句的，但是若从特定视图进行选择，而该视图使用了自己的 ORDER BY 语句，则视图定义中的 ORDER BY 将被忽略。</em></p><h2 id=修改视图>修改视图</h2><p>因为视图是一个虚拟表，所以对视图的操作就是对底层基础表的操作，所以在修改时只有满足底层基本表的定义才能成功修改。</p><p>对于一个视图来说，如果包含以下结构的任意一种都是不可以被更新的：</p><ul><li>聚合函数 SUM()、MIN()、MAX()、COUNT() 等。</li><li>DISTINCT 关键字。</li><li>GROUP BY 子句。</li><li>HAVING 子句。</li><li>UNION 或 UNION ALL 运算符。</li><li>FROM 子句中包含多个表。</li></ul><p>视图归根结底还是从表派生出来的，因此，如果原表可以更新，那么 视图中的数据也可以更新。反之亦然，如果视图发生了改变，而原表没有进行相应更新的话，就无法保证数据的一致性了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 修改视图2的列名city_id为id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span>
</span></span><span style=display:flex><span>VIEW
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>city_country2</span> (id,city_name,cid,country_name)
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>SELECT</span> t1.<span style=color:#f92672>*</span>,t2.country_name <span style=color:#66d9ef>FROM</span> city t1,country t2 <span style=color:#66d9ef>WHERE</span> t1.cid<span style=color:#f92672>=</span>t2.id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改视图表中的城市名称北京为北京市
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> city_country 
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> city_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;北京市&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> city_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;北京&#39;</span>;
</span></span></code></pre></div><h2 id=删除视图>删除视图</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> VIEW <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>视图名</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;</span> [ , <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>视图名</span><span style=color:#ae81ff>2</span><span style=color:#f92672>&gt;</span> <span style=color:#960050;background-color:#1e0010>…</span>]
</span></span><span style=display:flex><span><span style=color:#75715e>-- 注意：需要有相应的权限才能成功删除。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> VIEW city_country;
</span></span></code></pre></div><h2 id=子查询和视图的关系>子查询和视图的关系</h2><p>子查询就是将用来定义视图的 SELECT 语句直接用于 FROM 子句当中。其中AS studentSum可以看作是子查询的名称，而且由于子查询是一次性的，所以子查询不会像视图那样保存在存储介质中， 而是在 SELECT 语句执行之后就消失了。</p><h1 id=连接查询多表查询>连接查询（多表查询）</h1><h2 id=笛卡尔积查询>笛卡尔积查询</h2><p>把两个表中具有相同 主键ID的数据连接起来</p><p><strong>单纯的select * from a,b是笛卡尔乘积</strong>。比如a表有5条数据，b表有3条数据，那么最后的结果有5*3=15条数据。</p><p>但是如果对两个表进行关联:select * from a,b where a.id = b.id 意思就变了，此时就等价于：select * from a inner join b on a.id = b.id。即就是<strong>内连接</strong>。
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-a79c08f891013866.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><p>INNER JOIN 产生的结果是AB的交集。
FULL [OUTER] JOIN 产生A和B的并集。
LEFT [OUTER] JOIN 产生表A的完全集，而B表中匹配的则有值，没有匹配的则以null值取代。
RIGHT [OUTER] JOIN 产生表B的完全集，而A表中匹配的则有值，没有匹配的则以null值取代</p><p>CROSS JOIN 把表A和表B的数据进行一个N*M的组合，即笛卡尔积。</p><h2 id=内连接查询>内连接查询</h2><p><strong>INNER JOIN：只保留两张表中完全匹配的结果集</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#66d9ef>FROM</span> <span style=color:#960050;background-color:#1e0010>表名</span><span style=color:#ae81ff>1</span> [<span style=color:#66d9ef>INNER</span>] <span style=color:#66d9ef>JOIN</span> <span style=color:#960050;background-color:#1e0010>表名</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>ON</span> <span style=color:#960050;background-color:#1e0010>条件</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 隐式内连接语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#66d9ef>FROM</span> <span style=color:#960050;background-color:#1e0010>表名</span><span style=color:#ae81ff>1</span>,<span style=color:#960050;background-color:#1e0010>表名</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>WHERE</span> <span style=color:#960050;background-color:#1e0010>条件</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> p.LastName, p.FirstName, o.OrderNo
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Persons p
</span></span><span style=display:flex><span><span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> Orders o
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> p.Id_P<span style=color:#f92672>=</span>o.Id_P <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>　　</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> p.LastName
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-798cff79aafdee78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><h2 id=左连接查询>左连接查询</h2><ul><li>查询左表的全部数据，和左右两张表有交集部分的数据</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#66d9ef>FROM</span> <span style=color:#960050;background-color:#1e0010>表名</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>LEFT</span> [<span style=color:#66d9ef>OUTER</span>] <span style=color:#66d9ef>JOIN</span> <span style=color:#960050;background-color:#1e0010>表名</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>ON</span> <span style=color:#960050;background-color:#1e0010>条件</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> p.LastName, p.FirstName, o.OrderNo
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Persons p
</span></span><span style=display:flex><span><span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> Orders o
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> p.Id_P<span style=color:#f92672>=</span>o.Id_P
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> p.LastName
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-7951f83402cc6026.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><h2 id=右连接>右连接</h2><ul><li>查询右表的全部数据，和左右两张表有交集部分的数据</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> p.LastName, p.FirstName, o.OrderNo
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Persons p
</span></span><span style=display:flex><span><span style=color:#66d9ef>RIGHT</span> <span style=color:#66d9ef>JOIN</span> Orders o
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> p.Id_P<span style=color:#f92672>=</span>o.Id_P
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> p.LastName
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-fd7eaa8cc12522ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><h2 id=全连接查询>全连接查询</h2><p><strong>FULL JOIN ,返回左表和右表中所有的行。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> p.LastName, p.FirstName, o.OrderNo
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Persons p
</span></span><span style=display:flex><span>FULL <span style=color:#66d9ef>JOIN</span> Orders o
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> p.Id_P<span style=color:#f92672>=</span>o.Id_P
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> p.LastName
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-e11d28c6df0d7187.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><h2 id=子查询>子查询</h2><ul><li>查询语句中嵌套了查询语句。我们就将嵌套查询称为子查询！</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span> <span style=color:#75715e>-- 结果是单行单列的可以作为条件，使用运算符进行判断！
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#75715e>-- 根据查询出来的最高年龄，查询姓名和年龄
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>SELECT</span> NAME,age <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>USER</span> <span style=color:#66d9ef>WHERE</span> age <span style=color:#f92672>=</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>MAX</span>(age) <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>USER</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#75715e>-- 结果是多行单列的可以作为条件，使用运算符in或not in进行判断！
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#75715e>-- 根据id查询订单
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> number,uid <span style=color:#66d9ef>FROM</span> orderlist <span style=color:#66d9ef>WHERE</span> uid <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> id <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>USER</span> <span style=color:#66d9ef>WHERE</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;张三&#39;</span> <span style=color:#66d9ef>OR</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;李四&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 结果是多行多列的可以作为一张虚拟表参与查询！
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 查询订单表中id大于4的订单信息和所属用户信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>USER</span> u,(<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orderlist <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>4</span>) o <span style=color:#66d9ef>WHERE</span> u.id<span style=color:#f92672>=</span>o.uid;
</span></span></code></pre></div><h2 id=自关联查询>自关联查询</h2><ul><li>同一张表中有数据关联。可以多次查询这同一个表！</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span>  <span style=color:#75715e>-- 查询所有员工的姓名及其直接上级的姓名，没有上级的员工也需要查询
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>  分析：
</span></span></span><span style=display:flex><span><span style=color:#75715e>  	员工姓名 employee表        直接上级姓名 employee表
</span></span></span><span style=display:flex><span><span style=color:#75715e>  	条件：employee.mgr = employee.id
</span></span></span><span style=display:flex><span><span style=color:#75715e>  	查询左表的全部数据，和左右两张表交集部分数据，使用左外连接
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  	t1.name,	<span style=color:#75715e>-- 员工姓名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  	t1.mgr,		<span style=color:#75715e>-- 上级编号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  	t2.id,		<span style=color:#75715e>-- 员工编号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  	t2.name     <span style=color:#75715e>-- 员工姓名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  	employee t1  <span style=color:#75715e>-- 员工表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>OUTER</span> <span style=color:#66d9ef>JOIN</span>
</span></span><span style=display:flex><span>  	employee t2  <span style=color:#75715e>-- 员工表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>ON</span>
</span></span><span style=display:flex><span>  	t1.mgr <span style=color:#f92672>=</span> t2.id;
</span></span></code></pre></div><h1 id=union>UNION</h1><p>将两个或更多查询的结果组合起来，并生成一个结果集，通常<strong>返回的列名取自第一个查询。</strong></p><p>所有查询的<strong>列数和列顺序</strong>必须相同。每个查询中涉及表的<strong>列的数据类型</strong>必须相同或兼容。</p><p><strong>默认会去除相同行</strong>，如果需要保留相同行，使用 UNION ALL。</p><p><strong>只能包含一个 ORDER BY 子句，并且必须位于语句的最后。</strong></p><p>在一个查询中从不同的表返回结构数据。
对一个表执行多个查询，按一个查询返回数据。
组合查询</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> cust_name, cust_contact, cust_email
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_state <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;IL&#39;</span>, <span style=color:#e6db74>&#39;IN&#39;</span>, <span style=color:#e6db74>&#39;MI&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> cust_name, cust_contact, cust_email
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Fun4All&#39;</span>;
</span></span></code></pre></div><h2 id=join-vs-union>JOIN vs UNION</h2><p>JOIN 中连接表的列可能不同，但在 UNION 中，<strong>所有查询的列数和列顺序必须相同。</strong></p><p><strong>UNION 将查询之后的行放在一起（垂直放置），但 JOIN 将查询之后的列放在一起（水平放置）</strong></p><h1 id=远程连接>远程连接</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>## 查看当前的用户</span>
</span></span><span style=display:flex><span>USE mysql;
</span></span><span style=display:flex><span>SELECT * FROM user;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 修改密码</span>
</span></span><span style=display:flex><span>@前用户名@后地址（ % 代表可以任意ip访问）
</span></span><span style=display:flex><span>mysql ALTER USER <span style=color:#e6db74>&#34;root&#34;</span>@<span style=color:#e6db74>&#34;localhost&#34;</span> IDENTIFIED  BY <span style=color:#e6db74>&#34;root&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 创建新用户</span>
</span></span><span style=display:flex><span>CREATE USER <span style=color:#e6db74>&#39;new_user&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;passwd&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 给用户赋权限</span>
</span></span><span style=display:flex><span>这里我赋的是全部的权限，*.* 表示数据库库的所有库和表，对应权限存储在mysql.user表中
</span></span><span style=display:flex><span>GRANT ALL ON *.* TO <span style=color:#e6db74>&#39;new_user&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GRANT SELECT, UPDATE ON day16.employee TO <span style=color:#e6db74>&#39;eric&#39;</span>@<span style=color:#e6db74>&#39;localhost&#39;</span> IDENTIFIED BY <span style=color:#e6db74>&#39;123456&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 刷新权限</span>
</span></span><span style=display:flex><span>flush privileges;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 取消远程控制</span>
</span></span><span style=display:flex><span>update user set host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;localhost&#39;</span> where user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;用户名&#39;</span>;
</span></span></code></pre></div><h2 id=删除用户>删除用户</h2><p><code>delete from user where user="用户名" and host='host权限（localhost/%）';</code></p><blockquote><p>&ndash;开放3306端口&ndash;
1.控制面板—系统和安全—windows防火墙—攻击设置—入栈规则
2.新建规则—选择端口
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-e649fed7e43e6b95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
3.指定开放的端口
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-a40b2644f02b64a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
4.允许连接，一直点下一步即可
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-4610a319e4a4f648.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p></blockquote><h1 id=pymysql模块>PyMySQL模块</h1><p>是默认开启MySQL的事务功能的，
因此，进行 &ldquo;增&rdquo;、 &ldquo;删&rdquo;、&ldquo;改"的时候，一定要使用db.commit()提交事务
一定要使用try…except…语句，因为万一没插入成功，其余代码都无法执行。当语句执行不成功，
我们就db.rollback()回滚到操作之前的状态；当语句执行成功，我们就db.commit()提交事务。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pymysql 
</span></span><span style=display:flex><span><span style=color:#75715e># 使用pymysql连接上mysql数据库服务器，创建了一个数据库对象；</span>
</span></span><span style=display:flex><span>db<span style=color:#f92672>=</span>pymysql<span style=color:#f92672>.</span>connect(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;localhost&#39;</span>,user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span>, password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                   port<span style=color:#f92672>=</span><span style=color:#ae81ff>3306</span>, db<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;test&#39;</span>, charset<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf8&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 开启mysql的游标功能，创建一个游标对象；</span>
</span></span><span style=display:flex><span>cursor <span style=color:#f92672>=</span> db<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 建表语句；</span>
</span></span><span style=display:flex><span>sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;create table person(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        id int auto_increment primary key not null,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        name varchar(10) not null,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        age int not null) charset=utf8&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 执行sql语句；</span>
</span></span><span style=display:flex><span>cursor<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 一次性插入一条数据；</span>
</span></span><span style=display:flex><span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;猪八戒&#34;</span>
</span></span><span style=display:flex><span>age <span style=color:#f92672>=</span> <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>insert into person(name,age) values (&#34;猪八戒&#34;,8000)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>commit()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;插入成功&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;插入失败&#34;</span>)
</span></span><span style=display:flex><span>    db<span style=color:#f92672>.</span>rollback()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 要执行的SQL语句；</span>
</span></span><span style=display:flex><span>sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from person&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># execute(query, args)：执行单条sql语句，接收的参数为sql语句本身和使用的参数列表，返回值为受影响的行数；</span>
</span></span><span style=display:flex><span><span style=color:#75715e># executemany(query, args)：执行单条sql语句，但是重复执行参数列表里的参数，返回值为受影响的行数；</span>
</span></span><span style=display:flex><span>cursor<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span><span style=color:#75715e># fetchone()：返回一条结果行；</span>
</span></span><span style=display:flex><span><span style=color:#75715e># fetchmany(size)：接收size条返回结果行。如果size的值大于返回的结果行的数量，则会返回cursor.arraysize条数据；</span>
</span></span><span style=display:flex><span><span style=color:#75715e># fetchall()：接收全部的返回结果行；</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchone()
</span></span><span style=display:flex><span>print(data)
</span></span><span style=display:flex><span><span style=color:#75715e>#关闭游标</span>
</span></span><span style=display:flex><span>cursor<span style=color:#f92672>.</span>close()    
</span></span><span style=display:flex><span><span style=color:#75715e># 关闭数据库连接</span>
</span></span><span style=display:flex><span>db<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><h1 id=pandas>pandas</h1><p>中的read_sql()方法，将提取到的数据直接转化为DataFrame，进行操作</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>df1 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_sql(<span style=color:#e6db74>&#34;select * from student where ssex=&#39;男&#39;&#34;</span>,db)
</span></span><span style=display:flex><span>display(df1)
</span></span><span style=display:flex><span>df2 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_sql(<span style=color:#e6db74>&#34;select * from student where ssex=&#39;女&#39;&#34;</span>,db)
</span></span><span style=display:flex><span>display(df2)
</span></span></code></pre></div><h1 id=数据约束表约束>数据约束（表约束）</h1><table><thead><tr><th>约束</th><th>说明</th></tr></thead><tbody><tr><td>PRIMARY KEY</td><td>主键约束</td></tr><tr><td>PRIMARY KEY AUTO_INCREMENT</td><td>主键、自动增长</td></tr><tr><td>UNIQUE</td><td>唯一约束</td></tr><tr><td>NOT NULL</td><td>非空约束</td></tr><tr><td>FOREIGN KEY</td><td>外键约束</td></tr><tr><td>FOREIGN KEY ON UPDATE CASCADE</td><td>外键级联更新</td></tr><tr><td>FOREIGN KEY ON DELETE CASCADE</td><td>外键级联删除</td></tr></tbody></table><ul><li>主键约束特点<ul><li>主键约束包含：非空和唯一两个功能</li><li>一张表只能有一个列作为主键</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 删除主键
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>;
</span></span><span style=display:flex><span> <span style=color:#75715e>-- 添加主键
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student MODIFY id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> EKY;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除唯一约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>INDEX</span> id;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加唯一约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student MODIFY id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>UNIQUE</span>;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#75715e>-- 删除自动增长
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student MODIFY id <span style=color:#66d9ef>INT</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加自动增长
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student MODIFY id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除非空约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student MODIFY id <span style=color:#66d9ef>INT</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加非空约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student MODIFY id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>;
</span></span></code></pre></div><ul><li><p>外键约束</p><ul><li>让表和表之间产生关系，从而保证数据的准确性！</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>CONSTRAINT</span> <span style=color:#960050;background-color:#1e0010>外键名</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#960050;background-color:#1e0010>本表外键列名</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#960050;background-color:#1e0010>主表名</span>(<span style=color:#960050;background-color:#1e0010>主表主键列名</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除外键
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orderlist <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> ou_fk1;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加外键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orderlist <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>CONSTRAINT</span> ou_fk1 <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (uid) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>USER</span>(id);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建user用户表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>USER</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,    <span style=color:#75715e>-- id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>             <span style=color:#75715e>-- 姓名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加用户数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#66d9ef>USER</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;张三&#39;</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;李四&#39;</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;王五&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建orderlist订单表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>orderlist</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,    <span style=color:#75715e>-- id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	number <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,          <span style=color:#75715e>-- 订单编号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	uid <span style=color:#66d9ef>INT</span>,                              <span style=color:#75715e>-- 外键字段，订单所属用户
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>CONSTRAINT</span> ou_fk1 <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (uid) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>USER</span>(id)   <span style=color:#75715e>-- 添加外键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加订单数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> orderlist <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm001&#39;</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm002&#39;</span>,<span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm003&#39;</span>,<span style=color:#ae81ff>2</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm004&#39;</span>,<span style=color:#ae81ff>2</span>),
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm005&#39;</span>,<span style=color:#ae81ff>3</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm006&#39;</span>,<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加一个订单，但是没有所属用户。无法添加
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> orderlist <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;hm007&#39;</span>,<span style=color:#ae81ff>8</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除王五这个用户，但是订单表中王五还有很多个订单呢。无法删除
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>USER</span> <span style=color:#66d9ef>WHERE</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;王五&#39;</span>;
</span></span></code></pre></div><ul><li>级联更新和级联删除<ul><li>当我想把user用户表中的某个用户删掉，我希望该用户所有的订单也随之被删除</li><li>当我想把user用户表中的某个用户id修改，我希望订单表中该用户所属的订单用户编号也随之修改</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 添加外键约束，同时添加级联更新和级联删除
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orderlist <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>CONSTRAINT</span> ou_fk1 <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (uid) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#66d9ef>USER</span>(id) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>CASCADE</span> <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将王五用户的id修改为5    订单表中的uid也随之被修改
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>USER</span> <span style=color:#66d9ef>SET</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将王五用户删除     订单表中该用户所有订单也随之删除
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>USER</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>;
</span></span></code></pre></div><h3 id=多表设计>多表设计</h3><ul><li><p>一对一
人和身份证！
在任意一个表建立外键，去关联另外一个表的主键</p></li><li><p>一对多</p></li></ul><p>一个用户可以有多个订单！。一个分类下可以有多个商品！
在多的一方，建立外键约束，来关联另一方主键</p><ul><li>多对多</li></ul><p>学生和课程。一个学生可以选择多个课程，一个课程也可以被多个学生选择！
需要借助第三张表中间表，中间表至少包含两个列，这两个列作为中间表的外键，分别关联两张表的主键</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建student表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>student</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;张三&#39;</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;李四&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建course表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>course</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> course <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;语文&#39;</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;数学&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建中间表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>stu_course</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>	sid <span style=color:#66d9ef>INT</span>, <span style=color:#75715e>-- 用于和student表的id进行外键关联
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	cid <span style=color:#66d9ef>INT</span>, <span style=color:#75715e>-- 用于和course表的id进行外键关联
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>CONSTRAINT</span> sc_fk1 <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (sid) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#a6e22e>student</span>(id), <span style=color:#75715e>-- 添加外键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>CONSTRAINT</span> sc_fk2 <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (cid) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#a6e22e>course</span>(id)   <span style=color:#75715e>-- 添加外键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> stu_course <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>2</span>);
</span></span></code></pre></div><h1 id=窗口函数>窗口函数</h1><p>开窗函数的引入是为了<strong>既显示聚合前的数据又显示聚合后的数据</strong>。即在每一行的最后一列添加聚合函数的结果。</p><p><strong>应用：1、topN问题或者组内排序问题2、连续登录问题</strong></p><p><strong>!!!!!!!!!!!!!窗口函数原则上只能写在select子句中</strong></p><ul><li>原则上，窗口函数只能在SELECT子句中使用。</li><li>窗口函数OVER 中的ORDER BY 子句并不会影响最终结果的排序。其只是用来决定窗口函数按何种顺序计算。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 聚合类型SUM\MIN\MAX\AVG\COUNT
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>sum</span>() <span style=color:#a6e22e>OVER</span>([PARTITION <span style=color:#66d9ef>BY</span> xxx][<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> xxx [<span style=color:#66d9ef>DESC</span>]])
</span></span><span style=display:flex><span><span style=color:#75715e>-- 排序类型：ROW_NUMBER\RANK\DENSE_RANK
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>ROW_NUMBER</span>() <span style=color:#a6e22e>OVER</span>([PARTITION <span style=color:#66d9ef>BY</span> xxx][<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> xxx [<span style=color:#66d9ef>DESC</span>]])
</span></span><span style=display:flex><span><span style=color:#75715e>-- 分区类型：NTILE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>NTILE</span>(number) <span style=color:#a6e22e>OVER</span>([PARTITION <span style=color:#66d9ef>BY</span> xxx][<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> xxx [<span style=color:#66d9ef>DESC</span>]])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- PARTITON BY 是用来分组，即选择要看哪个窗口，类似于 GROUP BY 子句的分组功能，但是 PARTITION BY 子句并不具备 GROUP BY 子句的汇总功能，并不会改变原始表中记录的行数。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ORDER BY 是用来排序，即决定窗口内，是按那种规则(字段)来排序的。
</span></span></span></code></pre></div><h2 id=执行顺序-1>执行顺序</h2><p>在加入窗口函数的基础上SQL的执行顺序也会发生变化，具体的执行顺序如下（window就是窗口函数）
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-cd689024f076a36a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-fbbe65cca6ca527b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt=专用窗口函数例如rank、row_number、lag和lead等，在窗口函数中有静态函数和动态函数的分类>
<code>rank()</code>排序相同时会重复，总数不会变 ，意思是会出现1、1、3这样的排序结果；
<code>dense_rank()</code> 排序相同时会重复，总数会减少，意思是会出现1、1、2这样的排序结果。
<code>row_number()</code> 则在排序相同时不重复，会根据顺序排序。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>  product_id
</span></span><span style=display:flex><span>       ,product_name
</span></span><span style=display:flex><span>       ,sale_price
</span></span><span style=display:flex><span>       ,<span style=color:#a6e22e>SUM</span>(sale_price) <span style=color:#a6e22e>OVER</span> (<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> product_id) <span style=color:#66d9ef>AS</span> current_sum
</span></span><span style=display:flex><span>       ,<span style=color:#a6e22e>AVG</span>(sale_price) <span style=color:#a6e22e>OVER</span> (<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> product_id) <span style=color:#66d9ef>AS</span> current_avg  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> product;  
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://s2.loli.net/2022/03/02/tEda1hNxDkmPYp4.png alt=quicker_203f8ccd-3534-4102-ac55-d8d8f48b90d6.png>
从上面的例子可以看出，在没有partition by 的情况下，是把整个表作为一个大的窗口，SUM（）相当于向下累加，AVG（）相当于求从第一行到当前行的平均值，<strong>其他的聚合函数均是如此</strong>。</p><p>注意点：</p><p>1 、在使用专用的窗口函数时，例如rank、lag等，rank（）括号里是不需要指定任何字段的，直接空着就可以；
2 、在使用聚合函数做窗口函数时，SUM（）括号里必须有字段，得指定对哪些字段执行聚合的操作。在学习的初期很容易弄混，不同函数括号里是否需写相应的字段名；</p><h2 id=滑动窗口函数>滑动窗口函数</h2><h3 id=preceding>Preceding</h3><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-5f33b14e770215a7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-c048cc9e17b7073b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
Rows 2 preceding 中文的意思是之前的两行，preceding可以把它理解为不含当前行情况下截止到之前几行。根据上图可以看出在每一行，都会求出<strong>当前行附近的3行(当前行+附近2行)数据的平均值</strong>，这种方法也叫作<strong>移动平均</strong>。</p><h3 id=following>Following</h3><p>Rows 2 following 中文意思是之后的两行，跟preceding正好相反，Preceding是向前，following是向后。
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-93d5c51eb26202a6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><h3 id=preceding跟following相结合>preceding跟following相结合</h3><p><img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-4b2be94447f8744d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt>
<img src=/imgs/img-lazy-loading.gif data-src=https://upload-images.jianshu.io/upload_images/18339009-85623bf00d8f8866?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p><p>从以上的运行结果可以看出是把每一行（当前行）的前一行和后一行作为汇总的依据。</p><h2 id=rollup---计算合计及小计>ROLLUP - 计算合计及小计</h2><p>常规的GROUP BY 只能得到每个分类的小计，有时候还需要计算分类的合计，可以用 ROLLUP关键字。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>  product_type
</span></span><span style=display:flex><span>       ,regist_date
</span></span><span style=display:flex><span>       ,<span style=color:#a6e22e>SUM</span>(sale_price) <span style=color:#66d9ef>AS</span> sum_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> product
</span></span><span style=display:flex><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> product_type, regist_date <span style=color:#66d9ef>WITH</span> ROLLUP;  
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://s2.loli.net/2022/03/02/VQFXiarmzDpNgh2.png alt=quicker_71be3383-3f87-4e5e-bc91-3cf92d194d7a.png></p><h1 id=备份与还原>备份与还原</h1><h2 id=命令行方式>命令行方式</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 备份(不需要登陆)</span>
</span></span><span style=display:flex><span>mysqldump -u root -p 数据库名 &gt; 保存路径
</span></span><span style=display:flex><span><span style=color:#75715e># 恢复</span>
</span></span><span style=display:flex><span>mysql -u root -p
</span></span><span style=display:flex><span>drop database 已备份数据库名;
</span></span><span style=display:flex><span>create database 已备份数据库名;
</span></span><span style=display:flex><span>use 已备份数据库名;
</span></span><span style=display:flex><span>source 保存路径;
</span></span></code></pre></div><h1 id=存储过程和函数>存储过程和函数</h1><p>存储过程和函数是 <strong>事先经过编译并存储在数据库中的一段 SQL 语句的集合</strong></p><p>存储过程和函数的好处</p><ul><li>存储过程和函数可以重复使用，减轻开发人员的工作量。类似于java中方法可以<strong>多次调用</strong></li><li><strong>减少网络流量</strong>，存储过程和函数位于服务器上，调用的时候只需要传递名称和参数即可</li><li>减少数据在数据库和应用服务器之间的传输，可以提高数据处理的效率</li><li>将一些业务逻辑在数据库层面来实现，可以<strong>减少代码层面的业务处理</strong></li></ul><p><strong>函数必须有返回值，存储过程没有返回值</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 修改分隔符为$
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DELIMITER<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建存储过程，封装分组查询学生总成绩的sql语句
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>stu_group</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>SELECT</span> gender,<span style=color:#a6e22e>SUM</span>(score) getSum <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> gender <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> getSum <span style=color:#66d9ef>ASC</span>;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改分隔符为分号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用stu_group存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>stu_group</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询数据库中所有的存储过程 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> mysql.proc <span style=color:#66d9ef>WHERE</span> db<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;数据库名称&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除stu_group存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>PROCEDURE</span> stu_group;
</span></span></code></pre></div><h2 id=存储过程语法>存储过程语法</h2><h3 id=变量>变量</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 定义变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DECLARE</span> <span style=color:#960050;background-color:#1e0010>变量名</span> <span style=color:#960050;background-color:#1e0010>数据类型</span> [<span style=color:#66d9ef>DEFAULT</span> <span style=color:#960050;background-color:#1e0010>默认值</span>];
</span></span><span style=display:flex><span><span style=color:#75715e>-- 变量赋值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SET</span> <span style=color:#960050;background-color:#1e0010>变量名</span> <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>变量值</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>列名</span> <span style=color:#66d9ef>INTO</span> <span style=color:#960050;background-color:#1e0010>变量名</span> <span style=color:#66d9ef>FROM</span> <span style=color:#960050;background-color:#1e0010>表名</span> [<span style=color:#66d9ef>WHERE</span> <span style=color:#960050;background-color:#1e0010>条件</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 定义两个int变量，用于存储男女同学的总分数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test3</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 注意： DECLARE定义的是局部变量，只能用在BEGIN END范围之内
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> men,women <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>10</span>;  <span style=color:#75715e>-- 定义变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SET</span> men <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;       <span style=color:#75715e>-- 为变量赋值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> NAME;                <span style=color:#75715e>-- 查询变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>SUM</span>(score) <span style=color:#66d9ef>INTO</span> men <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> gender<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;男&#39;</span>;    <span style=color:#75715e>-- 计算男同学总分数赋值给men
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>SUM</span>(score) <span style=color:#66d9ef>INTO</span> women <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> gender<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;女&#39;</span>;  <span style=color:#75715e>-- 计算女同学总分数赋值给women
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>SELECT</span> men,women;           <span style=color:#75715e>-- 查询变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span></code></pre></div><h3 id=if>if</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- IF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>IF</span> <span style=color:#960050;background-color:#1e0010>判断条件</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>执行的</span>sql<span style=color:#960050;background-color:#1e0010>语句</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>ELSEIF</span> <span style=color:#960050;background-color:#1e0010>判断条件</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>执行的</span>sql<span style=color:#960050;background-color:#1e0010>语句</span><span style=color:#ae81ff>2</span>;]
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>ELSE</span> <span style=color:#960050;background-color:#1e0010>执行的</span>sql<span style=color:#960050;background-color:#1e0010>语句</span>n;]
</span></span><span style=display:flex><span>END <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	定义一个int变量，用于存储班级总成绩
</span></span></span><span style=display:flex><span><span style=color:#75715e>	定义一个varchar变量，用于存储分数描述
</span></span></span><span style=display:flex><span><span style=color:#75715e>	根据总成绩判断：
</span></span></span><span style=display:flex><span><span style=color:#75715e>		380分及以上    学习优秀
</span></span></span><span style=display:flex><span><span style=color:#75715e>		320 ~ 380     学习不错
</span></span></span><span style=display:flex><span><span style=color:#75715e>		320以下       学习一般
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test4</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义总分数变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> total <span style=color:#66d9ef>INT</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义分数描述变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> description <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 为总分数变量赋值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>SUM</span>(score) <span style=color:#66d9ef>INTO</span> total <span style=color:#66d9ef>FROM</span> student;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 判断总分数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>IF</span> total <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>380</span> <span style=color:#66d9ef>THEN</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习优秀&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>ELSEIF</span> total <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>320</span> <span style=color:#66d9ef>AND</span> total <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>380</span> <span style=color:#66d9ef>THEN</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习不错&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>ELSE</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习一般&#39;</span>;
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 查询总成绩和描述信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> total,description;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span></code></pre></div><h3 id=输入参数>输入参数</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#960050;background-color:#1e0010>存储过程名称</span>([<span style=color:#66d9ef>IN</span><span style=color:#f92672>|</span><span style=color:#66d9ef>OUT</span><span style=color:#f92672>|</span><span style=color:#66d9ef>INOUT</span>] <span style=color:#960050;background-color:#1e0010>参数名</span> <span style=color:#960050;background-color:#1e0010>数据类型</span>)
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>执行的</span>sql<span style=color:#960050;background-color:#1e0010>语句</span>;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	IN:代表输入参数，需要由调用者传递实际数据。默认的
</span></span></span><span style=display:flex><span><span style=color:#75715e>	OUT:代表输出参数，该参数可以作为返回值
</span></span></span><span style=display:flex><span><span style=color:#75715e>	INOUT:代表既可以作为输入参数，也可以作为输出参数
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>@</span><span style=color:#960050;background-color:#1e0010>变量名</span>:  <span style=color:#960050;background-color:#1e0010>这种变量要在变量名称前面加上“</span><span style=color:#f92672>@</span><span style=color:#960050;background-color:#1e0010>”符号，叫做用户会话变量，代表整个会话过程他都是有作用的，这个类似于全局变量一样。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>@@</span><span style=color:#960050;background-color:#1e0010>变量名</span>: <span style=color:#960050;background-color:#1e0010>这种在变量前加上</span> <span style=color:#e6db74>&#34;@@&#34;</span> <span style=color:#960050;background-color:#1e0010>符号</span>, <span style=color:#960050;background-color:#1e0010>叫做系统变量</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	输入总成绩变量，代表学生总成绩
</span></span></span><span style=display:flex><span><span style=color:#75715e>	输出分数描述变量，代表学生总成绩的描述
</span></span></span><span style=display:flex><span><span style=color:#75715e>	根据总成绩判断：
</span></span></span><span style=display:flex><span><span style=color:#75715e>		380分及以上  学习优秀
</span></span></span><span style=display:flex><span><span style=color:#75715e>		320 ~ 380    学习不错
</span></span></span><span style=display:flex><span><span style=color:#75715e>		320以下      学习一般
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test6</span>(<span style=color:#66d9ef>IN</span> total <span style=color:#66d9ef>INT</span>,<span style=color:#66d9ef>OUT</span> description <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 判断总分数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>IF</span> total <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>380</span> <span style=color:#66d9ef>THEN</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习优秀&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>ELSEIF</span> total <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>320</span> <span style=color:#66d9ef>AND</span> total <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>380</span> <span style=color:#66d9ef>THEN</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习不错&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>ELSE</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习一般&#39;</span>;
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用pro_test6存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test6</span>(<span style=color:#ae81ff>310</span>,<span style=color:#f92672>@</span>dscription);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询总成绩描述
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>@</span>description;
</span></span></code></pre></div><h3 id=case>case</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CASE</span> <span style=color:#960050;background-color:#1e0010>表达式</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>值</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>执行</span>sql<span style=color:#960050;background-color:#1e0010>语句</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>值</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>执行</span>sql<span style=color:#960050;background-color:#1e0010>语句</span><span style=color:#ae81ff>2</span>;]
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>ELSE</span> <span style=color:#960050;background-color:#1e0010>执行</span>sql<span style=color:#960050;background-color:#1e0010>语句</span>n;]
</span></span><span style=display:flex><span>END <span style=color:#66d9ef>CASE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	输入总成绩变量，代表学生总成绩
</span></span></span><span style=display:flex><span><span style=color:#75715e>	定义一个varchar变量，用于存储分数描述
</span></span></span><span style=display:flex><span><span style=color:#75715e>	根据总成绩判断：
</span></span></span><span style=display:flex><span><span style=color:#75715e>		380分及以上  学习优秀
</span></span></span><span style=display:flex><span><span style=color:#75715e>		320 ~ 380    学习不错
</span></span></span><span style=display:flex><span><span style=color:#75715e>		320以下      学习一般
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test7</span>(<span style=color:#66d9ef>IN</span> total <span style=color:#66d9ef>INT</span>)
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> description <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 使用case判断
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>CASE</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>WHEN</span> total <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>380</span> <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习优秀&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>WHEN</span> total <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>320</span> <span style=color:#66d9ef>AND</span> total <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>380</span> <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习不错&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>ELSE</span> 
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>SET</span> description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;学习一般&#39;</span>;
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>CASE</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 查询分数描述信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> description;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用pro_test7存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test7</span>(<span style=color:#ae81ff>390</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test7</span>((<span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>SUM</span>(score) <span style=color:#66d9ef>FROM</span> student));
</span></span></code></pre></div><h3 id=while>while</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>初始化语句</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHILE</span> <span style=color:#960050;background-color:#1e0010>条件判断语句</span> DO
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>循环体语句</span>;
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>条件控制语句</span>;
</span></span><span style=display:flex><span>END <span style=color:#66d9ef>WHILE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	计算1~100之间的偶数和
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test8</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义求和变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> result <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义初始化变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> num <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- while循环
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>WHILE</span> num <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>100</span> DO
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 偶数判断
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>IF</span> num<span style=color:#f92672>%</span><span style=color:#ae81ff>2</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>SET</span> result <span style=color:#f92672>=</span> result <span style=color:#f92672>+</span> num; <span style=color:#75715e>-- 累加
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		END <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 让num+1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>SET</span> num <span style=color:#f92672>=</span> num <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;         
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>WHILE</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 查询求和结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> result;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用pro_test8存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test8</span>();
</span></span></code></pre></div><h3 id=repeat>repeat</h3><p>注意：repeat循环是条件满足则停止。while循环是条件满足则执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>初始化语句</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>REPEAT</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>循环体语句</span>;
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>条件控制语句</span>;
</span></span><span style=display:flex><span>	UNTIL <span style=color:#960050;background-color:#1e0010>条件判断语句</span>
</span></span><span style=display:flex><span>END <span style=color:#66d9ef>REPEAT</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	计算1~10之间的和
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test9</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义求和变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> result <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义初始化变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> num <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- repeat循环
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>REPEAT</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 累加
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>SET</span> result <span style=color:#f92672>=</span> result <span style=color:#f92672>+</span> num;
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 让num+1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>SET</span> num <span style=color:#f92672>=</span> num <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 停止循环
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		UNTIL num<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>REPEAT</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 查询求和结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> result;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用pro_test9存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test9</span>();
</span></span></code></pre></div><h3 id=loop>loop</h3><p>注意：loop可以实现简单的循环，但是退出循环需要使用其他的语句来定义。我们可以使用leave语句完成！
<strong>如果不加退出循环的语句，那么就变成了死循环。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>初始化语句</span>;
</span></span><span style=display:flex><span>[<span style=color:#960050;background-color:#1e0010>循环名称</span>:] <span style=color:#66d9ef>LOOP</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>条件判断语句</span>
</span></span><span style=display:flex><span>		[<span style=color:#66d9ef>LEAVE</span> <span style=color:#960050;background-color:#1e0010>循环名称</span>;]
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>循环体语句</span>;
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>条件控制语句</span>;
</span></span><span style=display:flex><span>END <span style=color:#66d9ef>LOOP</span> <span style=color:#960050;background-color:#1e0010>循环名称</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 注意：loop可以实现简单的循环，但是退出循环需要使用其他的语句来定义。我们可以使用leave语句完成！
</span></span></span><span style=display:flex><span><span style=color:#75715e>--      如果不加退出循环的语句，那么就变成了死循环。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	计算1~10之间的和
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test10</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义求和变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> result <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义初始化变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> num <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- loop循环
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	l:<span style=color:#66d9ef>LOOP</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 条件成立，停止循环
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>IF</span> num <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>LEAVE</span> l;
</span></span><span style=display:flex><span>		END <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 累加
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>SET</span> result <span style=color:#f92672>=</span> result <span style=color:#f92672>+</span> num;
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 让num+1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>SET</span> num <span style=color:#f92672>=</span> num <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>LOOP</span> l;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 查询求和结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> result;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用pro_test10存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test10</span>();
</span></span></code></pre></div><h3 id=游标>游标</h3><ul><li>游标可以遍历返回的多行结果，每次拿到一整行数据</li><li>在存储过程和函数中可以使用游标对结果集进行循环的处理</li><li>简单来说游标就<strong>类似于集合的迭代器遍历</strong></li><li><strong>MySQL中的游标只能用在存储过程和函数中</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建游标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DECLARE</span> <span style=color:#960050;background-color:#1e0010>游标名称</span> <span style=color:#66d9ef>CURSOR</span> <span style=color:#66d9ef>FOR</span> <span style=color:#960050;background-color:#1e0010>查询</span>sql<span style=color:#960050;background-color:#1e0010>语句</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 打开游标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>OPEN <span style=color:#960050;background-color:#1e0010>游标名称</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 使用游标获取数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>FETCH</span> <span style=color:#960050;background-color:#1e0010>游标名称</span> <span style=color:#66d9ef>INTO</span> <span style=color:#960050;background-color:#1e0010>变量名</span><span style=color:#ae81ff>1</span>,<span style=color:#960050;background-color:#1e0010>变量名</span><span style=color:#ae81ff>2</span>,...;
</span></span><span style=display:flex><span><span style=color:#75715e>-- - 关闭游标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>CLOSE <span style=color:#960050;background-color:#1e0010>游标名称</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	将student表中所有的成绩保存到stu_score表中
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> <span style=color:#a6e22e>pro_test11</span>()
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义成绩变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> s_score <span style=color:#66d9ef>INT</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 定义标记变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> flag <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 创建游标,查询所有学生成绩数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> stu_result <span style=color:#66d9ef>CURSOR</span> <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>SELECT</span> score <span style=color:#66d9ef>FROM</span> student;
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 游标结束后，将标记变量改为1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> <span style=color:#66d9ef>EXIT</span> HANDLER <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>NOT</span> FOUND <span style=color:#66d9ef>SET</span> flag <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 开启游标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	OPEN stu_result;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 循环使用游标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>REPEAT</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 使用游标，遍历结果,拿到数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>FETCH</span> stu_result <span style=color:#66d9ef>INTO</span> s_score;
</span></span><span style=display:flex><span>		<span style=color:#75715e>-- 将数据保存到stu_score表中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> stu_score <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,s_score);
</span></span><span style=display:flex><span>	UNTIL flag<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	END <span style=color:#66d9ef>REPEAT</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 关闭游标
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	CLOSE stu_result;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用pro_test11存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CALL</span> <span style=color:#a6e22e>pro_test11</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询stu_score表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> stu_score;
</span></span></code></pre></div><h2 id=存储函数>存储函数</h2><p>存储函数有返回值，存储过程没有返回值(参数的out其实也相当于是返回数据了)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 标准语法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> FUNCTION <span style=color:#960050;background-color:#1e0010>函数名称</span>([<span style=color:#960050;background-color:#1e0010>参数</span> <span style=color:#960050;background-color:#1e0010>数据类型</span>])
</span></span><span style=display:flex><span>RETURNS <span style=color:#960050;background-color:#1e0010>返回值类型</span>
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>执行的</span>sql<span style=color:#960050;background-color:#1e0010>语句</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>RETURN</span> <span style=color:#960050;background-color:#1e0010>结果</span>;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用存储函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>函数名称</span>(<span style=color:#960050;background-color:#1e0010>实际参数</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除存储函
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> FUNCTION <span style=color:#960050;background-color:#1e0010>函数名称</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	定义存储函数，获取学生表中成绩大于95分的学生数量
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> FUNCTION <span style=color:#a6e22e>fun_test1</span>()
</span></span><span style=display:flex><span>RETURNS <span style=color:#66d9ef>INT</span>
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 定义统计变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>DECLARE</span> result <span style=color:#66d9ef>INT</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 查询成绩大于95分的学生数量，给统计变量赋值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>INTO</span> result <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> score <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>95</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>-- 返回统计结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>RETURN</span> result;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用fun_test1存储函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#a6e22e>fun_test1</span>();
</span></span></code></pre></div><h1 id=触发器>触发器</h1><ul><li>触发器是与表有关的数据库对象，可以<strong>在 insert/update/delete 之前或之后，触发并执行触发器中定义的SQL语句</strong>。触发器的这种特性可以协助应用<strong>在数据库端确保数据的完整性 、日志记录 、数据校验等操作</strong> 。</li><li>使用别名 NEW 和 OLD 来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在触发器还只支持行级触发，不支持语句级触发。</li></ul><table><thead><tr><th>触发器类型</th><th>OLD的含义</th><th>NEW的含义</th></tr></thead><tbody><tr><td>INSERT 型触发器</td><td>无 (因为插入前状态无数据)</td><td>NEW 表示将要或者已经新增的数据</td></tr><tr><td>UPDATE 型触发器</td><td>OLD 表示修改之前的数据</td><td>NEW 表示将要或已经修改后的数据</td></tr><tr><td>DELETE 型触发器</td><td>OLD 表示将要或者已经删除的数据</td><td>无 (因为删除后状态无数据)</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> <span style=color:#960050;background-color:#1e0010>触发器名称</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>BEFORE</span><span style=color:#f92672>|</span>AFTER <span style=color:#66d9ef>INSERT</span><span style=color:#f92672>|</span><span style=color:#66d9ef>UPDATE</span><span style=color:#f92672>|</span><span style=color:#66d9ef>DELETE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> <span style=color:#960050;background-color:#1e0010>表名</span>
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> ROW]  <span style=color:#75715e>-- 行级触发器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>触发器要执行的功能</span>;
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span></code></pre></div><h2 id=触发器演示>触发器演示</h2><p>通过触发器记录账户表的数据变更日志。包含：增加、修改、删除</p><ul><li>创建账户表</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建db9数据库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> db9;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 使用db9数据库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>USE</span> db9;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建账户表account
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>account</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,	<span style=color:#75715e>-- 账户id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>),					<span style=color:#75715e>-- 姓名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	money <span style=color:#66d9ef>DOUBLE</span>						<span style=color:#75715e>-- 余额
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;张三&#39;</span>,<span style=color:#ae81ff>1000</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;李四&#39;</span>,<span style=color:#ae81ff>2000</span>);
</span></span></code></pre></div><ul><li>创建日志表</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建日志表account_log
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>account_log</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,	<span style=color:#75715e>-- 日志id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	operation <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>),				<span style=color:#75715e>-- 操作类型 (insert update delete)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	operation_time <span style=color:#66d9ef>DATETIME</span>,			<span style=color:#75715e>-- 操作时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	operation_id <span style=color:#66d9ef>INT</span>,					<span style=color:#75715e>-- 操作表的id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	operation_params <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>200</span>)       <span style=color:#75715e>-- 操作参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span></code></pre></div><ul><li>创建INSERT触发器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建INSERT触发器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> account_insert
</span></span><span style=display:flex><span>AFTER <span style=color:#66d9ef>INSERT</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> account
</span></span><span style=display:flex><span><span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> ROW
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account_log <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;INSERT&#39;</span>,<span style=color:#a6e22e>NOW</span>(),new.id,<span style=color:#a6e22e>CONCAT</span>(<span style=color:#e6db74>&#39;插入后{id=&#39;</span>,new.id,<span style=color:#e6db74>&#39;,name=&#39;</span>,new.name,<span style=color:#e6db74>&#39;,money=&#39;</span>,new.money,<span style=color:#e6db74>&#39;}&#39;</span>));
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 向account表添加记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;王五&#39;</span>,<span style=color:#ae81ff>3000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询account表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询日志表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account_log;
</span></span></code></pre></div><ul><li>创建UPDATE触发器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建UPDATE触发器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> account_update
</span></span><span style=display:flex><span>AFTER <span style=color:#66d9ef>UPDATE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> account
</span></span><span style=display:flex><span><span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> ROW
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account_log <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;UPDATE&#39;</span>,<span style=color:#a6e22e>NOW</span>(),new.id,<span style=color:#a6e22e>CONCAT</span>(<span style=color:#e6db74>&#39;修改前{id=&#39;</span>,old.id,<span style=color:#e6db74>&#39;,name=&#39;</span>,old.name,<span style=color:#e6db74>&#39;,money=&#39;</span>,old.money,<span style=color:#e6db74>&#39;}&#39;</span>,<span style=color:#e6db74>&#39;修改后{id=&#39;</span>,new.id,<span style=color:#e6db74>&#39;,name=&#39;</span>,new.name,<span style=color:#e6db74>&#39;,money=&#39;</span>,new.money,<span style=color:#e6db74>&#39;}&#39;</span>));
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改account表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> account <span style=color:#66d9ef>SET</span> money<span style=color:#f92672>=</span><span style=color:#ae81ff>3500</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询account表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询日志表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account_log;
</span></span></code></pre></div><ul><li>创建DELETE触发器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建DELETE触发器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>DELIMITER <span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> account_delete
</span></span><span style=display:flex><span>AFTER <span style=color:#66d9ef>DELETE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> account
</span></span><span style=display:flex><span><span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> ROW
</span></span><span style=display:flex><span>BEGIN
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account_log <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;DELETE&#39;</span>,<span style=color:#a6e22e>NOW</span>(),old.id,<span style=color:#a6e22e>CONCAT</span>(<span style=color:#e6db74>&#39;删除前{id=&#39;</span>,old.id,<span style=color:#e6db74>&#39;,name=&#39;</span>,old.name,<span style=color:#e6db74>&#39;,money=&#39;</span>,old.money,<span style=color:#e6db74>&#39;}&#39;</span>));
</span></span><span style=display:flex><span>END<span style=color:#960050;background-color:#1e0010>$</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DELIMITER ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除account表数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> account <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询account表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询日志表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account_log;
</span></span></code></pre></div><ul><li>查看、删除触发器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>SHOW</span> TRIGGERS;
</span></span><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TRIGGER</span> account_delete;
</span></span></code></pre></div><h1 id=事务>事务</h1><p><strong>一条或多条 SQL 语句组成一个执行单元</strong>，其特点是<strong>这个单元要么同时成功要么同时失败</strong>，单元中的每条 SQL 语句都相互依赖，形成一个整体，如果某条 SQL 语句执行失败或者出现错误，那么整个单元就会回滚，撤回到事务最初的状态，如果单元中所有的 SQL 语句都执行成功，则事务就顺利执行。</p><p>操作事务的三个步骤</p><ol><li>开启事务：记录回滚点，并通知服务器，将要执行一组操作，要么同时成功、要么同时失败</li><li>执行sql语句：执行具体的一条或多条sql语句</li><li>结束事务(提交|回滚)<ul><li>提交：没出现问题，数据进行更新</li><li>回滚：出现问题，数据恢复到开启事务时的状态</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>START TRANSACTION;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 张三给李四转账500元
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 1.张三账户-500
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> account <span style=color:#66d9ef>SET</span> money<span style=color:#f92672>=</span>money<span style=color:#f92672>-</span><span style=color:#ae81ff>500</span> <span style=color:#66d9ef>WHERE</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;张三&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 2.李四账户+500
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 出错了...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> account <span style=color:#66d9ef>SET</span> money<span style=color:#f92672>=</span>money<span style=color:#f92672>+</span><span style=color:#ae81ff>500</span> <span style=color:#66d9ef>WHERE</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;李四&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 回滚事务(出现问题)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>ROLLBACK;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务(没出现问题)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改为手动提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SET</span> <span style=color:#f92672>@@</span>AUTOCOMMIT<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看提交方式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>@@</span>AUTOCOMMIT;  <span style=color:#75715e>-- 1代表自动提交    0代表手动提交
</span></span></span></code></pre></div><h2 id=事务的四大特征acid>事务的四大特征(ACID)</h2><ul><li>原子性(atomicity)<ul><li>原子性是指事务包含的所有操作<strong>要么全部成功，要么全部失败回滚</strong>，因此事务的操作如果成功就必须要完全应用到数据库，如果操作失败则不能对数据库有任何影响</li></ul></li><li>一致性(consistency)<ul><li>一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说<strong>一个事务执行之前和执行之后都必须处于一致性状态</strong></li><li>拿转账来说，假设张三和李四两者的钱加起来一共是2000，那么不管A和B之间如何转账，转几次账，<strong>事务结束后两个用户的钱相加起来应该还得是200</strong>0，这就是事务的一致性</li></ul></li><li>隔离性(isolcation)<ul><li>隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，<strong>多个并发事务之间要相互隔离</strong></li></ul></li><li>持久性(durability)<ul><li><strong>持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的</strong>，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作</li></ul></li></ul><h2 id=事务的隔离级别>事务的隔离级别</h2><h3 id=隔离级别的概念>隔离级别的概念</h3><ul><li><p>多个客户端操作时 ,各个客户端的事务之间应该是隔离的，相互独立的 , 不受影响的。</p></li><li><p>而如果<strong>多个事务操作同一批数据时，则需要设置不同的隔离级别</strong> , 否则就会产生问题 。</p></li><li><p>四种隔离级别</p></li></ul><table><thead><tr><th>1</th><th>读未提交</th><th>read uncommitted</th></tr></thead><tbody><tr><td><strong>2</strong></td><td><strong>读已提交</strong></td><td><strong>read committed</strong></td></tr><tr><td><strong>3</strong></td><td><strong>可重复读</strong></td><td><strong>repeatable read</strong></td></tr><tr><td><strong>4</strong></td><td><strong>串行化</strong></td><td><strong>serializable</strong></td></tr></tbody></table><ul><li>可能引发的问题</li></ul><table><thead><tr><th>问题</th><th>现象</th></tr></thead><tbody><tr><td><strong>脏读</strong></td><td><strong>是指在一个事务处理过程中读取了另一个未提交的事务中的数据 , 导致两次查询结果不一致</strong></td></tr><tr><td><strong>不可重复读</strong></td><td><strong>是指在一个事务处理过程中读取了另一个事务中修改并已提交的数据, 导致两次查询结果不一致</strong></td></tr><tr><td><strong>幻读</strong></td><td><strong>select 某记录是否存在，不存在，准备插入此记录，但执行 insert 时发现此记录已存在，无法插入。或不存在执行delete删除，却发现删除成功</strong></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 修改数据库隔离级别为read uncommitted
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SET</span> GLOBAL TRANSACTION ISOLATION LEVEL <span style=color:#66d9ef>read</span> uncommitted;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>@@</span>TX_ISOLATION;   <span style=color:#75715e>-- 修改后需要断开连接重新开
</span></span></span></code></pre></div><h3 id=事务隔离级别演示>事务隔离级别演示</h3><ul><li><p>脏读的问题</p><ul><li>窗口1</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查询账户表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置隔离级别为read uncommitted
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> global transaction isolation level <span style=color:#66d9ef>read</span> uncommitted;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 转账
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> account <span style=color:#66d9ef>set</span> money <span style=color:#f92672>=</span> money <span style=color:#f92672>-</span> <span style=color:#ae81ff>500</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> account <span style=color:#66d9ef>set</span> money <span style=color:#f92672>=</span> money <span style=color:#f92672>+</span> <span style=color:#ae81ff>500</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 窗口2查询转账结果 ,出现脏读(查询到其他事务未提交的数据)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 窗口2查看转账结果后，执行回滚
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>rollback;
</span></span></code></pre></div><ul><li>窗口2</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查询隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>tx_isolation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span></code></pre></div></li><li><p>解决脏读的问题和演示不可重复读的问题</p><ul><li>窗口1</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 设置隔离级别为read committed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> global transaction isolation level <span style=color:#66d9ef>read</span> committed;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 转账
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> account <span style=color:#66d9ef>set</span> money <span style=color:#f92672>=</span> money <span style=color:#f92672>-</span> <span style=color:#ae81ff>500</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> account <span style=color:#66d9ef>set</span> money <span style=color:#f92672>=</span> money <span style=color:#f92672>+</span> <span style=color:#ae81ff>500</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 窗口2查看转账结果，并没有发生变化(脏读问题被解决了)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行提交事务。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 窗口2查看转账结果，数据发生了变化(出现了不可重复读的问题，读取到其他事务已提交的数据)
</span></span></span></code></pre></div><ul><li>窗口2</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查询隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>tx_isolation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span></code></pre></div></li><li><p>解决不可重复读的问题</p><ul><li>窗口1</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 设置隔离级别为repeatable read
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> global transaction isolation level repeatable <span style=color:#66d9ef>read</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 转账
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> account <span style=color:#66d9ef>set</span> money <span style=color:#f92672>=</span> money <span style=color:#f92672>-</span> <span style=color:#ae81ff>500</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>update</span> account <span style=color:#66d9ef>set</span> money <span style=color:#f92672>=</span> money <span style=color:#f92672>+</span> <span style=color:#ae81ff>500</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 窗口2查看转账结果，并没有发生变化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 这个时候窗口2只要还在上次事务中，看到的结果都是相同的。只有窗口2结束事务，才能看到变化(不可重复读的问题被解决)
</span></span></span></code></pre></div><ul><li>窗口2</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查询隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>tx_isolation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>commit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span></code></pre></div></li><li><p>幻读的问题和解决</p><ul><li>窗口1</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 设置隔离级别为repeatable read
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> global transaction isolation level repeatable <span style=color:#66d9ef>read</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加一条记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>,<span style=color:#e6db74>&#39;王五&#39;</span>,<span style=color:#ae81ff>1500</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表，本窗口可以查看到id为3的结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span></code></pre></div><ul><li>窗口2</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查询隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>tx_isolation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表，查询不到新添加的id为3的记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加id为3的一条数据，发现添加失败。出现了幻读
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>,<span style=color:#e6db74>&#39;测试&#39;</span>,<span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表，查询到了新添加的id为3的记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span></code></pre></div><ul><li>解决幻读的问题</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	窗口1
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置隔离级别为serializable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> global transaction isolation level serializable;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加一条记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>,<span style=color:#e6db74>&#39;赵六&#39;</span>,<span style=color:#ae81ff>1600</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表，本窗口可以查看到id为4的结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	窗口2
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>tx_isolation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>start transaction;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账户表，发现查询语句无法执行，数据表被锁住！只有窗口1提交事务后，才可以继续操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> account;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加id为4的一条数据，发现已经存在了，就不会再添加了！幻读的问题被解决
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> account <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>,<span style=color:#e6db74>&#39;测试&#39;</span>,<span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span></code></pre></div></li></ul><h3 id=隔离级别总结>隔离级别总结</h3><table><thead><tr><th></th><th>隔离级别</th><th>名称</th><th>出现脏读</th><th>出现不可重复读</th><th>出现幻读</th><th>数据库默认隔离级别</th></tr></thead><tbody><tr><td>1</td><td><strong>read uncommitted</strong></td><td>读未提交</td><td>是</td><td>是</td><td>是</td><td></td></tr><tr><td>2</td><td><strong>read committed</strong></td><td>读已提交</td><td>否</td><td>是</td><td>是</td><td>Oracle / SQL Server</td></tr><tr><td>3</td><td><strong>repeatable read</strong></td><td>可重复读</td><td>否</td><td>否</td><td>是</td><td>MySQL</td></tr><tr><td>4</td><td>**serializable **</td><td>串行化</td><td>否</td><td>否</td><td>否</td><td></td></tr></tbody></table><blockquote><p>注意：隔离级别从小到大安全性越来越高，但是效率越来越低 , 所以不建议使用READ UNCOMMITTED 和 SERIALIZABLE 隔离级别.</p></blockquote><h1 id=索引>索引</h1><ul><li><p>MySQL数据库中的索引：是帮助MySQL高效获取数据的一种数据结构！所以，索引的本质就是数据结构。</p></li><li><p>在表数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式指向数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p></li><li><p>一张数据表，用于保存数据。 一个索引配置文件，用于保存索引，每个索引都去指向了某一个数据(表格演示)</p></li></ul><h2 id=索引的分类>索引的分类</h2><ul><li><p>功能分类</p><ul><li>普通索引： 最基本的索引，它没有任何限制。</li><li>唯一索引：索引列的值必须<strong>唯一，但允许有空值</strong>。如果是组合索引，则列值组合必须唯一。</li><li>主键索引：一种<strong>特殊的唯一索引，不允许有空值</strong>。一般在建表时同时创建主键索引。</li><li>组合索引：顾名思义，就是将单列索引进行组合。</li><li>外键索引：<strong>只有InnoDB引擎</strong>支持外键索引，用来保证数据的一致性、完整性和实现级联操作。</li><li>全文索引：快速匹配全部文档的方式。InnoDB引擎5.6版本后才支持全文索引。MEMORY引擎不支持。</li></ul></li><li><p>结构分类</p><ul><li>B+Tree索引 ：MySQL使用最频繁的一个索引数据结构，是InnoDB和MyISAM存储引擎默认的索引类型。</li><li>Hash索引 : MySQL中Memory存储引擎默认支持的索引类型。</li></ul></li><li><p>注意：如果一个表中有一列是主键，那么就会默认为其创建主键索引！(主键列不需要单独创建索引)</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> [<span style=color:#66d9ef>UNIQUE</span><span style=color:#f92672>|</span><span style=color:#66d9ef>FULLTEXT</span>] <span style=color:#66d9ef>INDEX</span> <span style=color:#960050;background-color:#1e0010>索引名称</span>
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>USING</span> <span style=color:#960050;background-color:#1e0010>索引类型</span>]  <span style=color:#75715e>-- 默认是B+TREE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ON</span> <span style=color:#960050;background-color:#1e0010>表名</span>(<span style=color:#960050;background-color:#1e0010>列名</span>...);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 为student表中姓名列创建一个普通索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_name <span style=color:#66d9ef>ON</span> <span style=color:#a6e22e>student</span>(NAME);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 为student表中年龄列创建一个唯一索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>UNIQUE</span> <span style=color:#66d9ef>INDEX</span> idx_age <span style=color:#66d9ef>ON</span> <span style=color:#a6e22e>student</span>(age);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看student表中的索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#66d9ef>FROM</span> student;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- -------------------alter语句添加索引
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 普通索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#960050;background-color:#1e0010>索引名称</span>(<span style=color:#960050;background-color:#1e0010>列名</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 组合索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#960050;background-color:#1e0010>索引名称</span>(<span style=color:#960050;background-color:#1e0010>列名</span><span style=color:#ae81ff>1</span>,<span style=color:#960050;background-color:#1e0010>列名</span><span style=color:#ae81ff>2</span>,...);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 主键索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#960050;background-color:#1e0010>主键列名</span>); 
</span></span><span style=display:flex><span><span style=color:#75715e>-- 外键索引(添加外键约束，就是外键索引)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>CONSTRAINT</span> <span style=color:#960050;background-color:#1e0010>外键名</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#960050;background-color:#1e0010>本表外键列名</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#960050;background-color:#1e0010>主表名</span>(<span style=color:#960050;background-color:#1e0010>主键列名</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 唯一索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>UNIQUE</span> <span style=color:#960050;background-color:#1e0010>索引名称</span>(<span style=color:#960050;background-color:#1e0010>列名</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 全文索引(mysql只支持文本类型)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>FULLTEXT</span> <span style=color:#960050;background-color:#1e0010>索引名称</span>(<span style=color:#960050;background-color:#1e0010>列名</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 为student表中name列添加全文索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> student <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>FULLTEXT</span> <span style=color:#a6e22e>idx_fulltext_name</span>(name);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看student表中的索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#66d9ef>FROM</span> student;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除student表中的idx_score索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>INDEX</span> idx_score <span style=color:#66d9ef>ON</span> student;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看student表中的索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#66d9ef>FROM</span> student;
</span></span></code></pre></div><h2 id=索引的实现原理>索引的实现原理</h2><ul><li>索引是在MySQL的存储引擎中实现的，所以每种存储引擎的索引不一定完全相同，也不是所有的引擎支持所有的索引类型。这里我们主要介绍<strong>InnoDB引擎的实现的B+Tree索引</strong>。</li><li>B+Tree是一种树型数据结构，是B-Tree的变种。通常使用在数据库和操作系统中的文件系统，特点是能够<strong>保持数据稳定有序</strong>。我们逐步的来了解一下。</li></ul><h3 id=磁盘存储>磁盘存储</h3><ul><li>系统从<strong>磁盘读取数据到内存时是以磁盘块（block）为基本单位</strong></li><li>位于<strong>同一个磁盘块中的数据会被一次性读取出来</strong>，而不是需要什么取什么。</li><li>InnoDB存储引擎中有页（Page）的概念，<strong>页是其磁盘管理的最小单位</strong>。InnoDB存储引擎中默认每个页的大小为16KB。</li><li>InnoDB引擎将若干个地址连接磁盘块，以此来达到页的大小16KB，在查询数据时如果一个页中的每条数据都能有助于定位数据记录的位置，这将会减少磁盘I/O次数，提高查询效率。</li></ul><h3 id=btree>BTree</h3><ul><li><p>BTree结构的数据可以让系统高效的找到数据所在的磁盘块。为了描述BTree，首先定义一条记录为一个二元组[key, data] ，key为记录的键值，对应表中的主键值，data为一行记录中除主键外的数据。对于不同的记录，key值互不相同。BTree中的每个节点根据实际情况可以包含大量的关键字信息和分支，如下图所示为一个3阶的BTree：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://s2.loli.net/2022/02/06/U7EhQ6vYgN2KRWS.png alt=05.png></p></li></ul><p>查找顺序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>模拟查找</span><span style=color:#ae81ff>15</span><span style=color:#960050;background-color:#1e0010>的过程</span> : 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>.<span style=color:#960050;background-color:#1e0010>根节点找到磁盘块</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>，读入内存。【磁盘</span>I<span style=color:#f92672>/</span>O<span style=color:#960050;background-color:#1e0010>操作第</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>次】</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>比较关键字</span><span style=color:#ae81ff>15</span><span style=color:#960050;background-color:#1e0010>在区间（</span><span style=color:#f92672>&lt;</span><span style=color:#ae81ff>17</span><span style=color:#960050;background-color:#1e0010>），找到磁盘块</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>的指针</span>P1<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>.P1<span style=color:#960050;background-color:#1e0010>指针找到磁盘块</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>，读入内存。【磁盘</span>I<span style=color:#f92672>/</span>O<span style=color:#960050;background-color:#1e0010>操作第</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>次】</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>比较关键字</span><span style=color:#ae81ff>15</span><span style=color:#960050;background-color:#1e0010>在区间（</span><span style=color:#f92672>&gt;</span><span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>），找到磁盘块</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>的指针</span>P3<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>.P3<span style=color:#960050;background-color:#1e0010>指针找到磁盘块</span><span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>，读入内存。【磁盘</span>I<span style=color:#f92672>/</span>O<span style=color:#960050;background-color:#1e0010>操作第</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>次】</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>在磁盘块</span><span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>中找到关键字</span><span style=color:#ae81ff>15</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#75715e>-- 分析上面过程，发现需要3次磁盘I/O操作，和3次内存查找操作。
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 由于内存中的关键字是一个有序表结构，可以利用二分法查找提高效率。而3次磁盘I/O操作是影响整个BTree查找效率的决定因素。BTree使用较少的节点个数，使每次磁盘I/O取到内存的数据都发挥了作用，从而提高了查询效率。
</span></span></span></code></pre></div><h3 id=btree-1>B+Tree</h3><ul><li>B+Tree是在BTree基础上的一种优化，使其更适合实现外存储索引结构，InnoDB存储引擎就是用B+Tree实现其索引结构。</li><li>从上一节中的BTree结构图中可以看到每个节点中不仅包含数据的key值，还有data值。而每一个页的存储空间是有限的，<strong>如果data数据较大时将会导致每个节点（即一个页）能存储的key的数量很小，当存储的数据量很大时同样会导致B-Tree的深度较大，增大查询时的磁盘I/O次数</strong>，进而影响查询效率。在B+Tree中，所有数据记录节点都是按照键值大小顺序存放在同一层的叶子节点上，而非叶子节点上只存储key值信息，这样可以大大加大每个节点存储的key值数量，降低B+Tree的高度。</li><li>B+Tree相对于BTree区别：<ul><li><strong>非叶子节点只存储键值信息。数据记录都存放在叶子节点中</strong>。</li><li><strong>所有叶子节点之间都有一个连接指针</strong>。</li><li>将上一节中的BTree优化，由于B+Tree的非叶子节点只存储键值信息，假设每个磁盘块能存储4个键值及指针信息，则变成B+Tree后其结构如下图所示：</li></ul></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://s2.loli.net/2022/02/06/u7dmevbAjzVg5il.png alt=06.png></p><p>通常在B+Tree上有两个头指针，<strong>一个指向根节点，另一个指向关键字最小的叶子节点</strong>，而且<strong>所有叶子节点（即数据节点）之间是一种链式环结构</strong>。因此可以对B+Tree进行两种查找运算：</p><ul><li>【有范围】对于主键的范围查找和分页查找</li><li>【有顺序】从根节点开始，进行随机查找</li></ul><p>实际情况中每个节点可能不能填充满，因此在数据库中，<strong>B+Tree的高度一般都在2~4层</strong>。MySQL的InnoDB存储引擎在设计时是将<strong>根节点常驻内存的</strong>，也就是说查找某一键值的行记录时<strong>最多只需要1~3次磁盘I/O操作</strong>。</p><h2 id=索引的设计原则>索引的设计原则</h2><p>索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引。</p><ul><li>创建索引时的原则<ul><li>对<strong>查询频次较高，且数据量比较大的表建立索引</strong>。</li><li><strong>使用唯一索引，区分度越高，使用索引的效率越高</strong>。</li><li>索引字段的选择，最佳候选列应当<strong>从where子句的条件中提取</strong>，如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合。</li><li><strong>使用短索引，提升索引访问的I/O效率</strong>，也可以提升总体的访问效率。假如构成索引的字段总长度比较短，那么在给定大小的存储块内可以存储更多的索引值，相应的可以有效的提升MySQL访问索引的I/O效率。</li><li>索引可以有效的提升查询数据的效率，但索引数量不是多多益善，<strong>索引越多，维护索引的代价自然也就水涨船高</strong>。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价，降低DML操作的效率，增加相应操作的时间消耗。另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但无疑提高了选择的代价。</li></ul></li><li>联合索引的特点</li></ul><p>在mysql建立联合索引时会遵循最左前缀匹配的原则，即最左优先，在检索数据时从联合索引的最左边开始匹配，</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#a6e22e>index_three</span>(name,address,phone);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 联合索引index_three实际建立了(name)、(name,address)、(name,address,phone)三个索引。所以下面的三个SQL语句都可以命中索引。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> address <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;北京&#39;</span> <span style=color:#66d9ef>AND</span> phone <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;12345&#39;</span> <span style=color:#66d9ef>AND</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;张三&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;张三&#39;</span> <span style=color:#66d9ef>AND</span> address <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;北京&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;张三&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 上面三个查询语句执行时会依照最左前缀匹配原则，检索时分别会使用索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>(name,address,phone)
</span></span><span style=display:flex><span>(name,address)
</span></span><span style=display:flex><span>(name)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>进行数据匹配。</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>索引的字段可以是任意顺序的，如：</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 优化器会帮助我们调整顺序，下面的SQL语句都可以命中索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> address <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;北京&#39;</span> <span style=color:#66d9ef>AND</span> phone <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;12345&#39;</span> <span style=color:#66d9ef>AND</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;张三&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 联合索引中最左边的列不包含在条件查询中，下面的SQL语句就不会命中索
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> address<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;北京&#39;</span> <span style=color:#66d9ef>AND</span> phone<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;12345&#39;</span>;
</span></span></code></pre></div><h1 id=锁>锁</h1><h2 id=锁的概念>锁的概念</h2><ul><li><p>在我们学习事务的时候，讲解过事务的隔离性，可能会出现脏读、不可重复读、幻读的问题，当时我们的解决方式是通过修改事务的隔离级别来控制，<strong>但是数据库的隔离级别我们并不推荐修改</strong>。所以，锁的作用也可以解决掉之前的问题！</p></li><li><p>锁机制 : 数据库为了保证数据的一致性，而使各种共享的资源在被并发访问时变得有序所设计的一种规则。</p></li><li><p>举例，在电商网站购买商品时，商品表中只存有1个商品，而此时又有两个人同时购买，那么谁能买到就是一个关键的问题。</p><p>这里会用到事务进行一系列的操作：</p><ol><li>先从商品表中取出物品的数据</li><li>然后插入订单</li><li>付款后，再插入付款表信息</li><li>更新商品表中商品的数量</li></ol><p>以上过程中，使用锁可以对商品数量数据信息进行保护，实现隔离，即只允许第一位用户完成整套购买流程，而其他用户只能等待，这样就解决了并发中的矛盾问题。</p></li><li><p>在数据库中，数据是一种供许多用户共享访问的资源，如何保证数据并发访问的一致性、有效性，是所有数据库必须解决的一个问题，MySQL由于自身架构的特点，在不同的存储引擎中，都设计了面对特定场景的锁定机制，所以引擎的差别，导致锁机制也是有很大差别的。</p></li></ul><h2 id=锁的分类>锁的分类</h2><ul><li>按操作分类：<ul><li>共享锁：也叫读锁。<strong>数据可以被多个事务查间，但是不能修改</strong></li><li>排他锁：也叫写锁。<strong>当前的操作没有完成前，不能被其他事务加锁查询或修改</strong></li><li>注意：锁的兼容性<ul><li>共享锁和共享锁 兼容</li><li>共享锁和排他锁 冲突</li><li>排他锁和排他锁 冲突</li><li>排他锁和共享锁 冲突</li></ul></li></ul></li><li>按粒度分类：<ul><li>表级锁：操作时，会锁定整个表。开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突概率高，并发度最低。偏向于MyISAM存储引擎！</li><li>行级锁：<strong>操作时，会锁定当前操作行。开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高。偏向于InnoDB存储引擎！</strong></li><li>页级锁：锁的粒度、发生冲突的概率和加锁的开销介于表锁和行锁之间，会出现死锁，并发性能一般。</li></ul></li><li>按使用方式分类：<ul><li>悲观锁：<strong>每次查询数据时都认为别人会修改</strong>，很悲观，所以<strong>查询时加锁</strong>。</li><li>乐观锁：<strong>每次查询数据时都认为别人不会修改</strong>，很乐观，但是<strong>更新时会判断一下在此期间别人有没有去更新这个数据</strong></li></ul></li><li>不同存储引擎支持的锁</li></ul><table><thead><tr><th>存储引擎</th><th>表级锁</th><th>行级锁</th><th>页级锁</th></tr></thead><tbody><tr><td>MyISAM</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>InnoDB</td><td>支持</td><td><strong>支持</strong></td><td>不支持</td></tr><tr><td>MEMORY</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>BDB</td><td>支持</td><td>不支持</td><td><strong>支持</strong></td></tr></tbody></table><h2 id=演示innodb锁>演示InnoDB锁</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 共享锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>SELECT<span style=color:#960050;background-color:#1e0010>语句</span> <span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>IN</span> SHARE MODE;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 排他锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>SELECT<span style=color:#960050;background-color:#1e0010>语句</span> <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>UPDATE</span>;
</span></span></code></pre></div><ul><li>数据准备</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建db13数据库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> db13;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 使用db13数据库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>USE</span> db13;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建student表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>student</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>	age <span style=color:#66d9ef>INT</span>,
</span></span><span style=display:flex><span>	score <span style=color:#66d9ef>INT</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> student <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;张三&#39;</span>,<span style=color:#ae81ff>23</span>,<span style=color:#ae81ff>99</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;李四&#39;</span>,<span style=color:#ae81ff>24</span>,<span style=color:#ae81ff>95</span>),
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;王五&#39;</span>,<span style=color:#ae81ff>25</span>,<span style=color:#ae81ff>98</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;赵六&#39;</span>,<span style=color:#ae81ff>26</span>,<span style=color:#ae81ff>97</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	共享锁：数据可以被多个事务查询，但是不能修改
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>START TRANSACTION;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录。加入共享锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>IN</span> SHARE MODE;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询分数为99分的数据记录。加入共享锁(注意：InnoDB引擎如果不采用带索引的列。则会提升为表锁)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> score<span style=color:#f92672>=</span><span style=color:#ae81ff>99</span> <span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>IN</span> SHARE MODE;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口2
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>START TRANSACTION;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录(普通查询，可以查询)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录，并加入共享锁(可以查询。共享锁和共享锁兼容)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>IN</span> SHARE MODE;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改id为1的姓名为张三三(不能修改，会出现锁的情况。只有窗口1提交事务后，才能修改成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> student <span style=color:#66d9ef>SET</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;张三三&#39;</span> <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改id为2的姓名为李四四(修改成功，InnoDB引擎默认是行锁)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> student <span style=color:#66d9ef>SET</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;李四四&#39;</span> <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改id为3的姓名为王五五(注意：InnoDB引擎如果不采用带索引的列。则会提升为表锁)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> student <span style=color:#66d9ef>SET</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;王五五&#39;</span> <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	排他锁：加锁的数据，不能被其他事务加锁查询或修改
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>START TRANSACTION;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录，并加入排他锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>UPDATE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口2
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>START TRANSACTION;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录(普通查询没问题)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录，并加入共享锁(不能查询。因为排他锁不能和其他锁共存)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>IN</span> SHARE MODE;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询id为1的数据记录，并加入排他锁(不能查询。因为排他锁不能和其他锁共存)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> student <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>UPDATE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改id为1的姓名为张三(不能修改，会出现锁的情况。只有窗口1提交事务后，才能修改成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> student <span style=color:#66d9ef>SET</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;张三&#39;</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>COMMIT;
</span></span></code></pre></div><h2 id=演示myisam锁>演示MyISAM锁</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 读锁。加锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>READ</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 解锁(将当前会话所有的表进行解锁)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UNLOCK</span> <span style=color:#66d9ef>TABLES</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 写锁。加锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>WRITE</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 解锁(将当前会话所有的表进行解锁)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UNLOCK</span> <span style=color:#66d9ef>TABLES</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建product表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>product</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>),
</span></span><span style=display:flex><span>	price <span style=color:#66d9ef>INT</span>
</span></span><span style=display:flex><span>)<span style=color:#66d9ef>ENGINE</span> <span style=color:#f92672>=</span> MYISAM;  <span style=color:#75715e>-- 指定存储引擎为MyISAM
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> product <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;华为手机&#39;</span>,<span style=color:#ae81ff>4999</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;小米手机&#39;</span>,<span style=color:#ae81ff>2999</span>),
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;苹果&#39;</span>,<span style=color:#ae81ff>8999</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;中兴&#39;</span>,<span style=color:#ae81ff>1999</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	读锁：所有连接只能读取数据，不能修改
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 为product表加入读锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>TABLE</span> product <span style=color:#66d9ef>READ</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询product表(查询成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> product;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改华为手机的价格为5999(修改失败)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> product <span style=color:#66d9ef>SET</span> price<span style=color:#f92672>=</span><span style=color:#ae81ff>5999</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 解锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UNLOCK</span> <span style=color:#66d9ef>TABLES</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口2
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 查询product表(查询成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> product;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改华为手机的价格为5999(不能修改，窗口1解锁后才能修改成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> product <span style=color:#66d9ef>SET</span> price<span style=color:#f92672>=</span><span style=color:#ae81ff>5999</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	写锁：其他连接不能查询和修改数据
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 为product表添加写锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>LOCK</span> <span style=color:#66d9ef>TABLE</span> product <span style=color:#66d9ef>WRITE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询product表(查询成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> product;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改小米手机的金额为3999(修改成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> product <span style=color:#66d9ef>SET</span> price<span style=color:#f92672>=</span><span style=color:#ae81ff>3999</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 解锁
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UNLOCK</span> <span style=color:#66d9ef>TABLES</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 窗口2
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 查询product表(不能查询。只有窗口1解锁后才能查询成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> product;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改小米手机的金额为2999(不能修改。只有窗口1解锁后才能修改成功)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> product <span style=color:#66d9ef>SET</span> price<span style=color:#f92672>=</span><span style=color:#ae81ff>2999</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>;
</span></span></code></pre></div><h2 id=演示悲观锁和乐观锁>演示悲观锁和乐观锁</h2><ul><li><p>我们之前所学的行锁，表锁不论是读写锁都是悲观锁。</p></li><li><p>悲观锁和乐观锁使用前提</p><ul><li>对于<strong>读的操作远多于写的操作</strong>的时候，这时候一个更新操作加锁会阻塞所有的读取操作，降低了吞吐量。最后还要释放锁，锁是需要一些开销的，这时候可以选择<strong>乐观锁</strong>。</li><li>如果是<strong>读写比例差距不是非常大或者系统没有响应不及时，吞吐量瓶颈的问题</strong>，那就不要去使用乐观锁，它增加了复杂度，也带来了业务额外的风险。这时候可以选择<strong>悲观锁</strong>。</li></ul></li><li><p>乐观锁的实现方式</p><ul><li><p>版本号</p><ul><li>给数据表中添加一个version列，每次更新后都将这个列的值加1。</li><li>读取数据时，将版本号读取出来，在执行更新的时候，比较版本号。</li><li>如果相同则执行更新，如果不相同，说明此条数据已经发生了变化。</li><li>用户自行根据这个通知来决定怎么处理，比如重新开始一遍，或者放弃本次更新。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 创建city表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>city</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,  <span style=color:#75715e>-- 城市id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>20</span>),                   <span style=color:#75715e>-- 城市名称
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	VERSION <span style=color:#66d9ef>INT</span>                         <span style=color:#75715e>-- 版本号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> city <span style=color:#66d9ef>VALUES</span> (<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;北京&#39;</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;上海&#39;</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;广州&#39;</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>NULL</span>,<span style=color:#e6db74>&#39;深圳&#39;</span>,<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改北京为北京市
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 1.查询北京的version
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> VERSION <span style=color:#66d9ef>FROM</span> city <span style=color:#66d9ef>WHERE</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;北京&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 2.修改北京为北京市，版本号+1。并对比版本号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> city <span style=color:#66d9ef>SET</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;北京市&#39;</span>,VERSION<span style=color:#f92672>=</span>VERSION<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>WHERE</span> NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;北京&#39;</span> <span style=color:#66d9ef>AND</span> VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;
</span></span></code></pre></div></li><li><p>时间戳</p><ul><li>和版本号方式基本一样，给数据表中添加一个列，名称无所谓，数据类型需要是timestamp</li><li>每次更新后都将最新时间插入到此列。</li><li>读取数据时，将时间读取出来，在执行更新的时候，比较时间。</li><li>如果相同则执行更新，如果不相同，说明此条数据已经发生了变化。</li></ul></li></ul></li></ul><h2 id=锁的总结>锁的总结</h2><ul><li><p>表锁和行锁</p><ul><li>行锁：锁的粒度更细，加行锁的性能损耗较大。并发处理能力较高。InnoDB引擎默认支持！</li><li>表锁：锁的粒度较粗，加表锁的性能损耗较小。并发处理能力较低。InnoDB、MyISAM引擎支持！</li></ul></li><li><p>InnoDB锁优化建议</p><ul><li><p>尽量通过带索引的列来完成数据查询，从而避免InnoDB无法加行锁而升级为表锁。</p></li><li><p>合理设计索引，索引要尽可能准确，尽可能的缩小锁定范围，避免造成不必要的锁定。</p></li><li><p>尽可能减少基于范围的数据检索过滤条件。</p></li><li><p>尽量控制事务的大小，减少锁定的资源量和锁定时间长度。</p></li><li><p>在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁产生概率。</p></li><li><p>对于非常容易产生死锁的业务部分，可以尝试使用升级锁定颗粒度，通过表级锁定来减少死锁的产生。</p></li></ul></li></ul><h1 id=存储引擎>存储引擎</h1><h3 id=mysql体系结构>MySQL体系结构</h3><ul><li><p>体系结构的概念</p><ul><li>任何一套系统当中，每个部件都能起到一定的作用！</li></ul></li><li><p>MySQL的体系结构</p></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://s2.loli.net/2022/02/06/a9R3d7XYUIHPib5.png alt=02.png></p><ul><li>体系结构详解<ul><li>客户端连接<ul><li>支持接口：支持的客户端连接，例如C、Java、PHP等语言来连接MySQL数据库</li></ul></li><li>第一层：网络连接层<ul><li>连接池：管理、缓冲用户的连接，线程处理等需要缓存的需求。</li><li>例如：当客户端发送一个请求连接，会从连接池中获取一个连接进行使用。</li></ul></li><li>第二层：核心服务层<ul><li>管理服务和工具：系统的管理和控制工具，例如备份恢复、复制、集群等。</li><li>SQL接口：接受SQL命令，并且返回查询结果。</li><li>查询解析器：验证和解析SQL命令，例如过滤条件、语法结构等。</li><li>查询优化器：在执行查询之前，使用默认的一套优化机制进行优化sql语句</li><li>缓存：如果缓存当中有想查询的数据，则直接将缓存中的数据返回。没有的话再重新查询！</li></ul></li><li>第三层：存储引擎层<ul><li>插件式存储引擎：管理和操作数据的一种机制，包括(存储数据、如何更新、查询数据等)</li></ul></li><li>第四层：系统文件层<ul><li>文件系统：配置文件、数据文件、日志文件、错误文件、二进制文件等等的保存</li></ul></li></ul></li></ul><h3 id=mysql存储引擎>MySQL存储引擎</h3><ul><li><p>引擎的概念</p><ul><li>生活中，引擎就是整个机器运行的核心，不同的引擎具备不同的功能。</li></ul></li><li><p>MySQL存储引擎的概念</p><ul><li>MySQL数据库使用不同的机制存取表文件 , 机制的差别在于不同的<strong>存储方式、索引技巧、锁定水平以及广泛的不同的功能和能力</strong>，在MySQL中 , 将这些不同的技术及配套的功能称为<strong>存储引擎</strong></li><li>在关系型数据库中数据的存储是以表的形式存进行储的，所以存储引擎也可以称为<strong>表类型</strong>（即存储和操作此表的类型）。</li><li><strong>Oracle , SqlServer等数据库只有一种存储引擎</strong> , 而MySQL针对不同的需求, 配置MySQL的不同的存储引擎 , 就会让数据库采取了不同的处理数据的方式和扩展功能。</li><li>通过选择不同的引擎 ,能够获取最佳的方案 , 也能够获得额外的速度或者功能，提高程序的整体效果。所以了解引擎的特性 , 才能贴合我们的需求 , 更好的发挥数据库的性能。</li></ul></li><li><p>MySQL支持的存储引擎</p><ul><li>MySQL5.7支持的引擎包括：InnoDB、MyISAM、MEMORY、Archive、Federate、CSV、BLACKHOLE等</li><li>其中较为常用的有三种：InnoDB、MyISAM、MEMORY</li></ul></li></ul><h3 id=常用引擎的特性对比>常用引擎的特性对比</h3><ul><li>常用的存储引擎<ul><li>MyISAM存储引擎<ul><li>访问快,不支持事务和外键。表结构保存在.frm文件中，表数据保存在.MYD文件中，索引保存在.MYI文件中。</li></ul></li><li>InnoDB存储引擎(MySQL5.5版本后默认的存储引擎)<ul><li>支持事务 ,占用磁盘空间大 ,支持并发控制。表结构保存在.frm文件中，如果是共享表空间，数据和索引保存在 innodb_data_home_dir 和 innodb_data_file_path定义的表空间中，可以是多个文件。如果是多表空间存储，每个表的数据和索引单独保存在 .ibd 中。</li></ul></li><li>MEMORY存储引擎<ul><li>内存存储 , 速度快 ,不安全 ,适合小量快速访问的数据。表结构保存在.frm中。</li></ul></li></ul></li><li>特性对比</li></ul><table><thead><tr><th>特性</th><th>MyISAM</th><th>InnoDB</th><th>MEMORY</th></tr></thead><tbody><tr><td>存储限制</td><td>有(平台对文件系统大小的限制)</td><td>64TB</td><td>有(平台的内存限制)</td></tr><tr><td><strong>事务安全</strong></td><td><strong>不支持</strong></td><td><strong>支持</strong></td><td><strong>不支持</strong></td></tr><tr><td><strong>锁机制</strong></td><td><strong>表锁</strong></td><td><strong>表锁/行锁</strong></td><td><strong>表锁</strong></td></tr><tr><td>B+Tree索引</td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td>哈希索引</td><td>不支持</td><td>不支持</td><td>支持</td></tr><tr><td>全文索引</td><td>支持</td><td>支持</td><td>不支持</td></tr><tr><td><strong>集群索引</strong></td><td><strong>不支持</strong></td><td><strong>支持</strong></td><td><strong>不支持</strong></td></tr><tr><td>数据索引</td><td>不支持</td><td>支持</td><td>支持</td></tr><tr><td>数据缓存</td><td>不支持</td><td>支持</td><td>N/A</td></tr><tr><td>索引缓存</td><td>支持</td><td>支持</td><td>N/A</td></tr><tr><td>数据可压缩</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>空间使用</td><td>低</td><td>高</td><td>N/A</td></tr><tr><td>内存使用</td><td>低</td><td>高</td><td>中等</td></tr><tr><td>批量插入速度</td><td>高</td><td>低</td><td>高</td></tr><tr><td><strong>外键</strong></td><td><strong>不支持</strong></td><td><strong>支持</strong></td><td><strong>不支持</strong></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#75715e>-- 查询数据库支持的存储引擎
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> ENGINES;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 表含义:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#f92672>-</span> support : <span style=color:#960050;background-color:#1e0010>指服务器是否支持该存储引擎</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>-</span> transactions : <span style=color:#960050;background-color:#1e0010>指存储引擎是否支持事务</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>-</span> XA : <span style=color:#960050;background-color:#1e0010>指存储引擎是否支持分布式事务处理</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>-</span> Savepoints : <span style=color:#960050;background-color:#1e0010>指存储引擎是否支持保存点</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看db9数据库所有表的存储引擎
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>TABLE</span> STATUS <span style=color:#66d9ef>FROM</span> db9;  
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看db9数据库中stu_score表的存储引擎
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>TABLE</span> STATUS <span style=color:#66d9ef>FROM</span> db9 <span style=color:#66d9ef>WHERE</span> NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stu_score&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建engine_test表，指定存储引擎为MyISAM
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>engine_test</span>(
</span></span><span style=display:flex><span>	id <span style=color:#66d9ef>INT</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
</span></span><span style=display:flex><span>	NAME <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>)<span style=color:#66d9ef>ENGINE</span> <span style=color:#f92672>=</span> MYISAM;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询engine_test表的引擎
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>TABLE</span> STATUS <span style=color:#66d9ef>FROM</span> db11 <span style=color:#66d9ef>WHERE</span> NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;engine_test&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改engine_test表的引擎为InnoDB
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> engine_test <span style=color:#66d9ef>ENGINE</span> <span style=color:#f92672>=</span> INNODB;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询engine_test表的引擎
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>TABLE</span> STATUS <span style=color:#66d9ef>FROM</span> db11 <span style=color:#66d9ef>WHERE</span> NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;engine_test&#39;</span>;
</span></span></code></pre></div><h4 id=总结引擎的选择>总结：引擎的选择</h4><ul><li>MyISAM ：由于MyISAM不支持事务、不支持外键、支持全文检索和表级锁定，读写相互阻塞，读取速度快，节约资源，所以如果应用是以<strong>查询操作和插入操作为主</strong>，只有<strong>很少的更新和删除</strong>操作，并且<strong>对事务的完整性、并发性要求不是很高</strong>，那么选择这个存储引擎是非常合适的。</li><li>InnoDB : 是MySQL的默认存储引擎， 由于InnoDB支持事务、支持外键、行级锁定 ，支持所有辅助索引(5.5.5后不支持全文检索)，高缓存，所以用于对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，读写频繁的操作，那么InnoDB存储引擎是比较合适的选择，比如BBS、计费系统、充值转账等</li><li>MEMORY：将所有数据保存在RAM中，在需要快速定位记录和其他类似数据环境下，可以提供更快的访问。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，其次是要确保表的数据可以恢复，数据库异常终止后表中的数据是可以恢复的。<strong>MEMORY表通常用于更新不太频繁的小表，用以快速得到访问结果。</strong></li><li>总结：针对不同的需求场景，来选择最适合的存储引擎即可！如果不确定、则使用数据库默认的存储引擎！</li></ul></div><footer class=post-footer><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
面试-mysql</li><li class=post-copyright-author><strong>本文作者：</strong>
Tomding</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=/post/%E9%9D%A2%E8%AF%95-mysql/ title=面试-mysql>/post/%E9%9D%A2%E8%AF%95-mysql/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E9%9D%A2%E8%AF%95-ml/ rel=next title=面试-ML><i class="fa fa-chevron-left"></i> 面试-ML</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E9%9D%A2%E8%AF%95-mysql%E9%A2%98/ rel=prev title=面试-MySQL题>面试-MySQL题
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Tomding</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":false,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.e34208af37d3db3a875e6fbad04c2f1c241185af925a9c6ebf79dd1ba2730cdd.js defer></script></body></html>